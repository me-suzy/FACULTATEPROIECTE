
<SCRIPT>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
	',height=' + height + ',resizable=1,scrollbars=yes');
	}
	//-->
	</SCRIPT>



<FONT FACE="Arial,Helvetica" SIZE="-1">
To access the contents, click the chapter and section titles.
</FONT>
<P>
<B>Developing Java Enterprise Applications</B>
<FONT SIZE="-1">
<BR>
<I>(Publisher: John Wiley & Sons, Inc.)</I>
<BR>
Author(s): Stephen Asbury ; Scott R. Weiner
<BR>
ISBN: 0471327565
<BR>
Publication Date: 02/01/99
</FONT>
<P>
<Script language="JavaScript">
function isIE4() 
{
    return( navigator.appName.indexOf("Microsoft") != -1 && (navigator.appVersion.charAt(0)=='4') );
 }
function bookMarkit()
{
        var url="http://www.itknowledge.com/PSUser/EWBookMarks.html?url="+window.location+"&isbn=0";
	parent.location.href=url;
        //var win = window.open(url,"myitk");
        //if(!isIE4())
        //       win.focus();

}
</Script>
<a href="javascript:bookMarkit();"><img src="/images/bookmarkit.gif" border=0 alt="Bookmark It" width=97 height=23></a>

<P>
<form name="Search" method="GET" action="http://search.earthweb.com/search97/search_redir.cgi">

<INPUT TYPE="hidden" NAME="Action" VALUE="Search">
<INPUT TYPE="hidden" NAME="SearchPage" VALUE="http://search.earthweb.com/search97/samples/forms/srchdemo.htm">
<INPUT TYPE="hidden" NAME="Collection" VALUE="ITK">
<INPUT TYPE="hidden" NAME="ResultTemplate" VALUE="itk-simple-intrabook.hts">
<INPUT TYPE="hidden" NAME="ViewTemplate" VALUE="view.hts">

<font face="arial, helvetica" size=2><b>Search this book:</b></font><br>
<INPUT NAME="queryText" size=50 VALUE="">&nbsp;<input type="submit" name="submitbutton" value="Go!">
<INPUT type=hidden NAME="section_on" VALUE="on">
<INPUT type=hidden NAME="section" VALUE="http://www.itknowledge.com/reference/standard/0471327565/">

</form>


<!-- Empty Reference Subhead -->

<!--ISBN=0471327565//-->
<!--TITLE=Developing Java Enterprise Applications//-->
<!--AUTHOR=Stephen Asbury//-->
<!--AUTHOR=Scott R. Weiner//-->
<!--PUBLISHER=Wiley Computer Publishing//-->
<!--CHAPTER=10//-->
<!--PAGES=274-279//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="10-05.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="10-07.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<P><BR></P>
<P>The following example creates a JSP that defines a simple servlet called CountingServlet. CountingServlet keeps track of a current value in the instance variable count. This servlet extends HttpServlet This class will be referred to from a JSP, showing that a JSP can extend custom servlet classes.
</P>
<!-- CODE //-->
<PRE>
import java.io.*;
import java.util.*;
import javax.servlet.*;
import javax.servlet.http.*;

<B>public class CountingServlet extends HttpServlet</B>
{
    <B>protected int count;</B>
    
    public CountingServlet()
    {
        count = 0;
    }
}
</PRE>
<!-- END CODE //-->
<P>In the subclass, this value can be accessed and incremented directly from the JSP, as demonstrated in the boldface code of the following page.
</P>
<!-- CODE //-->
<PRE>
&ltHTML&gt
&ltHEAD&gt
&ltTITLE&gt
Using Extends
&lt/TITLE&gt
&lt/HEAD&gt
&ltBODY&gt
&ltjava type=import&gtCountingServlet&lt/java&gt
<B>&ltjava type=extends&gtCountingServlet&lt/java&gt</B>

&ltH2&gt
The Current Count is &ltjava type=print&gt<B>(count&#43;&#43;)</B>&lt/java&gt.
&lt/H2&gt

&lt/BODY&gt
&lt/HTML&gt
</PRE>
<!-- END CODE //-->
<P>Be sure to import the class you are extending. Because the code generated from the JSP is in a package, this import statement is required to get to classes not in the pagecompiler&#146;s package.
</P>
<P>Using extends can make your Web sites easier to maintain by grouping reusable code into a servlet for extending. This way, each JSP can reuse rather than reimplement code for the site. For example, your site could use a servlet superclass that provides data validation or formatting functions to the JSP. You might even implement the superclass to implement some form of resource pooling. This pooling would depend on the Web server&#146;s willingness to share a class between servlets.</P>
<BLOCKQUOTE>
<P><FONT SIZE="-1"><HR><B>NOTE:&nbsp;&nbsp;</B>If you change the code for the parent class of a JSP and recompile it, you may need to restart the Web server to see the changes.</FONT><HR>
</BLOCKQUOTE>
<P>The final type of &ltjava&gt tag for altering the generated code uses the type class. This tag takes the form:
</P>
<!-- CODE SNIP //-->
<PRE>
&ltjava type=class&gt<I>java code</I>&lt/java&gt
</PRE>
<!-- END CODE SNIP //-->
<P>The information in this block is treated as part of the servlet&#146;s class definition. It is not included in the service method, but it is included in the class. This type of &ltjava&gt block can be used to define methods and instance variables.
</P>
<P>As an example of what you can do with the type=class tag, we implemented a JavaServer Page that uses the Eliza package discussed in Chapter 7. This page defines the servlet&#146;s init method to initialize Eliza, our virtual psychologist, which is then stored in an instance variable. Requests made to the page result in an initial greeting (if no request is made) or a response to the previous input. Requests always display a form for talking to Eliza. The form uses backquotes and the HttpServletRequest to get the correct URL for the JSP. Normal &ltjava&gt tags are used to display the necessary HTML, and an import tag is used to import the Eliza package.</P>
<!-- CODE //-->
<PRE>
&ltHTML&gt
&ltHEAD&gt
&ltTITLE&gt
Eliza JSP
&lt/TITLE&gt
&lt/HEAD&gt
&ltBODY&gt

<B>&ltjava type=import&gtEliza.*&lt/java&gt

&ltjava type=class&gt</B>

    ElizaMain eliza;
    
    public void init(ServletConfig conf) throws ServletException
    {
        super.init(conf);
        
        String scriptFile=
            &#147;D:\\java\\jws1.1\\classes\\Eliza\\script&#148;;
        
        eliza = new ElizaMain();
        
        try
        {
            eliza.readScript(scriptFile);
        }
        catch(Exception exp)
        {
            eliza = null;
        }
    }
     
    protected String replyToMessage(String message)
    {
        String reply;
        
           try
           {
           if(message==null)
            {
                reply = &#147;Please enter a message to Eliza.&#148;;
            }
            else if(eliza != null)
            {
                reply = eliza.processInput(message);
            }
            else
            {
                reply = &#147;Sorry, Eliza is not available.&#148;;
            }
        }
        catch(Exception exp)
        {
            reply = &#147;I am having trouble hearing, &#148;
                    &#43;&#147;please repeat.&#148;;
        }
        
        return reply;
    }

<B>&lt/java&gt</B>

&ltjava&gt

String message;
message = request.getParameter(&#147;message&#148;);

if(message == null)
{
&lt/java&gt
Enter a message for Eliza.
&ltjava&gt
}
else
{
    out.println(replyToMessage(message));
}
&lt/java&gt

&ltFORM ACTION=&#145;<B>HttpUtils.getRequestURL(request)</B>&#146; METHOD=&#147;GET&#148;&gt
&ltINPUT TYPE=&#147;text&#148; NAME=&#147;message&#148; SIZE=36&gt
&ltINPUT TYPE=&#147;submit&#148; VALUE=&#147;Send&#148;&gt
&lt/FORM&gt
&lt/BODY&gt
&lt/HTML&gt
</PRE>
<!-- END CODE //-->
<P>When accessed, this page should look like the one in Figure 10.9.
</P>
<P>The Eliza package is available on the CD-ROM and should be included in the server&#146;s class path.</P>
<H3><A NAME="Heading12"></A><FONT COLOR="#000077">Accessing Other Servlets</FONT></H3>
<P>As well as defining all the code that they need, JavaServer Pages can access other servlets. This access is provided via the servlet tag. The servlet tag uses the following syntax:
</P>
<!-- CODE //-->
<PRE>
&ltservlet name=<I>ServletName</I>
code=<I>ServletCode</I>
codebase=<I>ServletCodeBase</I>
<I>initParam1</I>=<I>initArg1 initParam2</I>=<I>initArg2</I>&gt

&ltparam name=<I>param1</I> value=<I>val1</I>&gt
&ltparam name=<I>param2</I> value=<I>val2</I>&gt
.
.
.
&lt/servlet&gt
</PRE>
<!-- END CODE //-->
<P><A NAME="Fig9"></A><A HREF="javascript:displayWindow('images/10-09.jpg',762,344 )"><IMG SRC="images/10-09t.jpg"></A>
<BR><A HREF="javascript:displayWindow('images/10-09.jpg',762,344)"><FONT COLOR="#000077"><B>Figure 10.9</B></FONT></A>&nbsp;&nbsp;Eliza JavaServer Page.</P>
<P>The attributes initParam1 and initParam2 are the actual names of initialization parameters for the servlet. These initialization parameters are used to load the servlet into the Web server. You can provide as many of these values as necessary to initialize the servlet. The param tags are used to pass parameters to the servlet in the same way an HTML form defines parameters. The name you provide is the name that the server uses to identify the servlet, and the code value is the name of the servlet&#146;s class. The code base can provide a directory for the servlet code. The code base is optional and is the server&#146;s class path by default.
</P>
<P>When the page compiler sees the servlet tag, it is translated into a request to an instance of this servlet via the service method. For example, the following page accesses a servlet called AdLinkRotatorServlet and provides a number of initialization parameters.</P>
<!-- CODE //-->
<PRE>
&ltHTML&gt
&ltHEAD&gt
&ltTITLE&gt
Accessing a Servlet
&lt/TITLE&gt
&lt/HEAD&gt
&ltBODY&gt
&ltH2&gtA servlet is used to place an ad underneath this line.&lt/H2&gt
&ltHR&gt
<B>&ltservlet name=&#147;AdLinkRotator&#148; 
    code=&#147;AdLinkRotatorServlet&#148; 
    imagedir=&#147;c:\\servers\\javawebserver1.1\\public_html\\ads&#148; 
    imageroot=&#147;/ads&#148;&gt</B>
&lt/servlet&gt
&lt/BODY&gt
&lt/HTML&gt
</PRE>
<!-- END CODE //-->
<P><BR></P>
<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="10-05.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="10-07.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


<!-- 