
<SCRIPT>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
	',height=' + height + ',resizable=1,scrollbars=yes');
	}
	//-->
	</SCRIPT>



<FONT FACE="Arial,Helvetica" SIZE="-1">
To access the contents, click the chapter and section titles.
</FONT>
<P>
<B>Developing Java Enterprise Applications</B>
<FONT SIZE="-1">
<BR>
<I>(Publisher: John Wiley & Sons, Inc.)</I>
<BR>
Author(s): Stephen Asbury ; Scott R. Weiner
<BR>
ISBN: 0471327565
<BR>
Publication Date: 02/01/99
</FONT>
<P>
<Script language="JavaScript">
function isIE4() 
{
    return( navigator.appName.indexOf("Microsoft") != -1 && (navigator.appVersion.charAt(0)=='4') );
 }
function bookMarkit()
{
        var url="http://www.itknowledge.com/PSUser/EWBookMarks.html?url="+window.location+"&isbn=0";
	parent.location.href=url;
        //var win = window.open(url,"myitk");
        //if(!isIE4())
        //       win.focus();

}
</Script>
<a href="javascript:bookMarkit();"><img src="/images/bookmarkit.gif" border=0 alt="Bookmark It" width=97 height=23></a>

<P>
<form name="Search" method="GET" action="http://search.earthweb.com/search97/search_redir.cgi">

<INPUT TYPE="hidden" NAME="Action" VALUE="Search">
<INPUT TYPE="hidden" NAME="SearchPage" VALUE="http://search.earthweb.com/search97/samples/forms/srchdemo.htm">
<INPUT TYPE="hidden" NAME="Collection" VALUE="ITK">
<INPUT TYPE="hidden" NAME="ResultTemplate" VALUE="itk-simple-intrabook.hts">
<INPUT TYPE="hidden" NAME="ViewTemplate" VALUE="view.hts">

<font face="arial, helvetica" size=2><b>Search this book:</b></font><br>
<INPUT NAME="queryText" size=50 VALUE="">&nbsp;<input type="submit" name="submitbutton" value="Go!">
<INPUT type=hidden NAME="section_on" VALUE="on">
<INPUT type=hidden NAME="section" VALUE="http://www.itknowledge.com/reference/standard/0471327565/">

</form>


<!-- Empty Reference Subhead -->

<!--ISBN=0471327565//-->
<!--TITLE=Developing Java Enterprise Applications//-->
<!--AUTHOR=Stephen Asbury//-->
<!--AUTHOR=Scott R. Weiner//-->
<!--PUBLISHER=Wiley Computer Publishing//-->
<!--CHAPTER=10//-->
<!--PAGES=263-268//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="10-03.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="10-05.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<P><BR></P>
<P>Note the multiple &ltjava&gt-&lt/java&gt blocks surrounding the if-else statement and the HTML it displays. When compiled, this JSP defined results in the following Java servlet code.
</P>
<!-- CODE //-->
<PRE>
package pagecompile;

import java.io.*;
import java.util.*;
import javax.servlet.*;
import javax.servlet.http.*;
import com.sun.server.webserver.pagecompile.filecache.*;
import com.sun.server.webserver.pagecompile.ParamsHttpServletRequest;
import com.sun.server.webserver.pagecompile.*;

public class _Conditional extends HttpServlet
{

//-------------------------------
  static {}
  
  //-------------- The service method
  public void service (HttpServletRequest request,
                         HttpServletResponse response)
      throws ServletException, IOException
  {
    ServletOutputStream out = response.getOutputStream ();
    ByteFileData __fileData = null;
    
    try
    {
      __fileData = (ByteFileData) ServletUtil.getJHtmlSource(this,
      &#147;D:\\JAVA\\JWS1.1\\BIN\\..\\public_html\\Conditional.jhtml&#148;
      , null, 902612394000L);
      
      if (__fileData == null)
        throw new ServletException(&#147;FileChanged&#148;);

      /*** lines: 1-9 */
      __fileData.writeBytes (0, 95, out);

      <B>boolean test = false;</B>

      /*** lines: 11-13 */
      __fileData.writeBytes (132, 19, out);

      <B>if(test)
      {
        /*** lines: 16-18 */
        __fileData.writeBytes (176, 6, out);
      }
      else
      {
        /*** lines: 22-24 */
        __fileData.writeBytes (205, 7, out);
      }</B>

      /*** lines: 26-29 */
      __fileData.writeBytes (228, 23, out);
    }
    finally
    {
      if (__fileData != null) __fileData.close();
    }
  }
}
</PRE>
<!-- END CODE //-->
<P>The if-else block has been turned into an if-else statement in the servlet. The HTML outside the &ltjava&gt tags is sent to the client conditionally, based on the if-else statement.
</P>
<P>The same technique can be used to create a loop over a piece of HTML, as demonstrated in the following code. This JSP loops through an array of names and prints them using the implicit variable out. In this example, out is the servlet&#146;s output stream or PrintWriter as appropriate. The out variable and the other resources available in a JSP are discussed in detail in the next section.</P>
<!-- CODE //-->
<PRE>
&ltHTML&gt
&ltHEAD&gt
&ltTITLE&gt
Looping HTML
&lt/TITLE&gt
&lt/HEAD&gt
&ltBODY&gt
<B>&ltjava&gt
    String names[]={&#147;Tommy&#148;
                    ,&#147;Kristan&#148;
                    ,&#147;Cheryl&#148;
                    ,&#147;Stephen&#148;};
                    
    int i,max;
    
    max = names.length;
    
    for(i=0;i&ltmax;i&#43;&#43;)
    {
&lt/java&gt</B>
I see <B>&ltjava&gtout.println(names[i]);&lt/java&gt.</B>&ltBR&gt
<B>&ltjava&gt
    }
&lt/java&gt</B>
&lt/BODY&gt
&lt/HTML&gt
</PRE>
<!-- END CODE //-->
<P>The result of this code is shown in Figure 10.4.
</P>
<P>Using loops and conditionals that operate on regular HTML is a powerful technique that allows HTML designers to fill in the contents of a dynamic page while still relying on Java code to perform complex business and application logic. For example, in the case of a database query, the programmer can use Java code to fetch data and loop over the query results, relying on HTML from the designer to display each result. In this same query example, the programmer can branch based on the number of results, and the designer can provide different pages to the client based on whether data exists.</P>
<P><A NAME="Fig4"></A><A HREF="javascript:displayWindow('images/10-04.jpg',516,433 )"><IMG SRC="images/10-04t.jpg"></A>
<BR><A HREF="javascript:displayWindow('images/10-04.jpg',516,433)"><FONT COLOR="#000077"><B>Figure 10.4</B></FONT></A>&nbsp;&nbsp;Looping HTML.</P>
<H4 ALIGN="LEFT"><A NAME="Heading8"></A><FONT COLOR="#000077">Accessing Servlet Information</FONT></H4>
<P>By default, the expected encoding for JSP is regular ASCII HTML. In this case, HTML is returned to the client as bytes that match their character equivalents. As discussed previously, the PageCompileServlet automatically creates a stream for accessing the pipe to the client and calls it out. If you want to use another character-encoding scheme, specify it in the initialization parameters for the PageCompileServlet. For custom encodings, the variable out will be a PrintWriter object rather than a ServletOutputStream. In most cases, this shouldn&#146;t affect your calls to print or println, but it is an important fact for programmers who use non-ASCII character encodings in their pages.
</P>
<P>Besides out, the JSP has access to two variables, as defined in the generated service method. These values are request, an HttpServletRequest object, and response, an HttpServletResponse object. Both values can be referred to by name between the &ltjava&gt and &lt/java&gt tags. The following example uses the request object to print information about the client. This example is based on the PrintEnvServlet in Chapter 7, &#147;Programming Servlets.&#148;</P>
<!-- CODE //-->
<PRE>
&ltHTML&gt
&ltHEAD&gt
&ltTITLE&gt
Print Environment
&lt/TITLE&gt
&lt/HEAD&gt
&ltBODY&gt
&ltH1&gtRequested URL&lt/H1&gt

&ltjava&gt
out.println(HttpUtils.getRequestURL(request).toString());
&lt/java&gt

&ltBR&gt
&ltH1&gtHeaders&lt/H1&gt

&ltjava&gt
        Enumeration headers;
        String curHeader;
        
        headers = request.getHeaderNames();
        
        while(headers.hasMoreElements())
        {
            curHeader = (String) headers.nextElement();
            
            out.println(curHeader&#43;&#147;=&#148;
                         &#43;request.getHeader(curHeader)&#43;&#147;&ltBR&gt&#148;);
        }
&lt/java&gt

&ltBR&gt
&ltH1&gtRequest Information&lt/H1&gt

&ltjava&gt
        try
        {
            out.println(&#147;AuthType=&#148;&#43;request.getAuthType()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Scheme=&#148;&#43;request.getScheme()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Method=&#148;&#43;request.getMethod()&#43;&#147;&ltBR&gt&#148;);
        
        //Crashes on some servers.
        //  out.println(&#147;Char Encoding=&#148;
        //                &#43;request.getCharacterEncoding()&#43;&#147;&ltBR&gt&#148;);
        
            out.println(&#147;Request URI=&#148;
              &#43;request.getRequestURI()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Request protocol=&#148;
              &#43;request.getProtocol()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Servlet path=&#148;
              &#43;request.getServletPath()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Path Info=&#148;&#43;request.getPathInfo()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Path Translated=&#148;
              &#43;request.getPathTranslated()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Query String=&#148;
              &#43;request.getQueryString()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Content length=&#148;
              &#43;request.getContentLength()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Content type=&#148;
              &#43;request.getContentType()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Server name=&#148;
              &#43;request.getServerName()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Server port=&#148;
              &#43;request.getServerPort()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Remote user=&#148;
              &#43;request.getRemoteUser()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Remote address=&#148;
              &#43;request.getRemoteAddr()&#43;&#147;&ltBR&gt&#148;);
        
        //Times out if no DNS.
        //    out.println(&#147;Remote host=&#148;
        //          &#43;request.getRemoteHost()&#43;&#147;&ltBR&gt&#148;);
        }
        catch(Exception exp)
        {
            out.println(&#147;Exception: &#148;&#43;exp&#43;&#147;&ltBR&gt&#148;);
        }
&lt/java&gt        

&ltBR&gt
&ltH1&gtParameter Information&lt/H1&gt

&ltjava&gt
        Enumeration parameters;
        String[] values;
        String curParam;
        String value;
        int i,max;

        parameters = request.getParameterNames();
        
        while(parameters.hasMoreElements())
        {
            curParam = (String) parameters.nextElement();
            
            values = request.getParameterValues(curParam);
            value = request.getParameter(curParam);
            
            out.println(curParam&#43;&#147;=&ltBR&gt&ltUL&gt&#148;);
            
            if((values != null)&amp&amp(values.length&gt1))
            {
                max = values.length;
                
                for(i=0;i&ltmax;i&#43;&#43;)
                {
                    out.println(&#147;&ltLI&gt&#148;&#43;values[i]);
                }
            }
            else if(value != null)
            {
                out.println(&#147;&ltLI&gt&#148;&#43;value);
            }
            
            out.println(&#147;&lt/UL&gt&#148;);
        }
&lt/java&gt

&lt/BODY&gt
&lt/HTML&gt
</PRE>
<!-- END CODE //-->
<P><BR></P>
<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="10-03.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="10-05.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


<!-- 