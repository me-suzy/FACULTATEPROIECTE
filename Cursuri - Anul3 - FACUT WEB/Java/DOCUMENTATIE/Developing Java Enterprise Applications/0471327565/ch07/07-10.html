
<SCRIPT>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
	',height=' + height + ',resizable=1,scrollbars=yes');
	}
	//-->
	</SCRIPT>



<FONT FACE="Arial,Helvetica" SIZE="-1">
To access the contents, click the chapter and section titles.
</FONT>
<P>
<B>Developing Java Enterprise Applications</B>
<FONT SIZE="-1">
<BR>
<I>(Publisher: John Wiley & Sons, Inc.)</I>
<BR>
Author(s): Stephen Asbury ; Scott R. Weiner
<BR>
ISBN: 0471327565
<BR>
Publication Date: 02/01/99
</FONT>
<P>
<Script language="JavaScript">
function isIE4() 
{
    return( navigator.appName.indexOf("Microsoft") != -1 && (navigator.appVersion.charAt(0)=='4') );
 }
function bookMarkit()
{
        var url="http://www.itknowledge.com/PSUser/EWBookMarks.html?url="+window.location+"&isbn=0";
	parent.location.href=url;
        //var win = window.open(url,"myitk");
        //if(!isIE4())
        //       win.focus();

}
</Script>
<a href="javascript:bookMarkit();"><img src="/images/bookmarkit.gif" border=0 alt="Bookmark It" width=97 height=23></a>

<P>
<form name="Search" method="GET" action="http://search.earthweb.com/search97/search_redir.cgi">

<INPUT TYPE="hidden" NAME="Action" VALUE="Search">
<INPUT TYPE="hidden" NAME="SearchPage" VALUE="http://search.earthweb.com/search97/samples/forms/srchdemo.htm">
<INPUT TYPE="hidden" NAME="Collection" VALUE="ITK">
<INPUT TYPE="hidden" NAME="ResultTemplate" VALUE="itk-simple-intrabook.hts">
<INPUT TYPE="hidden" NAME="ViewTemplate" VALUE="view.hts">

<font face="arial, helvetica" size=2><b>Search this book:</b></font><br>
<INPUT NAME="queryText" size=50 VALUE="">&nbsp;<input type="submit" name="submitbutton" value="Go!">
<INPUT type=hidden NAME="section_on" VALUE="on">
<INPUT type=hidden NAME="section" VALUE="http://www.itknowledge.com/reference/standard/0471327565/">

</form>


<!-- Empty Reference Subhead -->

<!--ISBN=0471327565//-->
<!--TITLE=Developing Java Enterprise Applications//-->
<!--AUTHOR=Stephen Asbury//-->
<!--AUTHOR=Scott R. Weiner//-->
<!--PUBLISHER=Wiley Computer Publishing//-->
<!--CHAPTER=07//-->
<!--PAGES=174-177//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="07-09.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="07-11.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<P><BR></P>
<P>Once you get the session object, you can use it to access the session data as a set of named values. There are also methods for getting the session&#146;s id and information about its creation. All of these are listed in Table 7.14.
</P>
<P>When a session is first created, it is considered new. The session remains new until the client &#147;knows&#148; about the session. There are two ways the client learns about the session. First, the session-tracking mechanism tries to use cookies to tell the client about the session id. If the browser supports and accepts the cookie, this mechanism is transparent to the programmer. The other way to tell the client about the session is to send the session id as part of a URL. In this case, the programmer must encode all URLs sent to the client so that they include the session id. Obviously, cookies are easier to program with, but URL encoding is more portable between browsers. However, URL encoding works only if all the servlets and pages that contain URLs on the site encode them appropriately. This is often too much to ask of a large site, and many simply do not support sessions on browsers that do not support cookies. To encode a URL, use the methods encodeUrl and encodeRedirectUrl in the HttpResponse object.</P>
<P>The values in a session are all objects. On the Java Web Server, it is helpful to make these objects serializable so that they can be saved to disk, if necessary. However, any object will do. If you want to store custom objects, you can also implement the HttpSessionBindingListener interface. In this case, the object is notified when it is added or bound to a session and again when it is unbound. HttpSessionBindingListener defines the methods:</P>
<!-- CODE SNIP //-->
<PRE>
public void valueBound(HttpSessionBindingEvent event)
public void valueUnbound(HttpSessionBindingEvent event)
</PRE>
<!-- END CODE SNIP //-->
<P>The server calls these methods when the object is bound and unbound from the session. You might use this notification to update cached information or free resources being held by the object. For example, you might associate objects in a session with Enterprise JavaBeans. When the object is unbound, the relationship can be discontinued.
</P>
<P>Normally, it is up to the server configuration to determine when a session is no longer valid. Often this is a question of how much time has passed since the last access, but many servers are configurable. You can also invalidate a session directly by using the invalidate method of HTTPSession.</P>
<P>The following example code shows a simple servlet that keeps a counter for each time the servlet is accessed in the given session. It also prints some of the information provided by the session to the servlet.</P>
<P>The first time this servlet is accessed, it sets the counter to 0 and displays a page like the one in Figure 7.4. Accessing the servlet again displays a page like the one in Figure 7.5.</P>
<P>All the code for this servlet is included in the doGet method. The bold code creates the session and checks whether it is new before constructing the appropriate output. In all cases, a string containing a link back to the servlet is included for the user to press.</P>
<!-- CODE //-->
<PRE>
import java.io.*;
import java.util.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class SessionInfoServlet extends HttpServlet

{
    public void doGet(HttpServletRequest request,
                      HttpServletResponse response)
    throws ServletException, IOException
    {
<B>        HttpSession session = request.getSession(true);
</B>
        response.setContentType(&#147;text/html&#148;);
        PrintWriter out = response.getWriter();

        out.println(&#147;&ltHTML&gt&#148;);
        out.println(&#147;&ltHEAD&gt&#148;);
        out.println(&#147;&ltTITLE&gt&#148;);
        out.println(&#147;Session Info Servlet&#148;);
        out.println(&#147;&lt/TITLE&gt&#148;);
        out.println(&#147;&lt/HEAD&gt&#148;);
        out.println(&#147;&ltBODY&gt&#148;);

<B>        if(session.isNew())
        {
</B>            out.println(&#147;&ltH1&gtNew Session&lt/H1&gt&#148;);
            out.println(&#147;The count is set to 0.&#148;);

            session.putValue(&#147;sessioninfo.count&#148;,new Integer(1));
        <B>}
        else
        {
</B>            Integer count;
            int intCount=0;

            count = (Integer)
                      session.getValue(&#147;sessioninfo.count&#148;);
            if(count != null) intCount = count.intValue()&#43;1;

            out.println(&#147;&ltH1&gtSession Information&lt/H1&gt&#148;);
            out.println(&#147;The count is set to &#148;&#43;intCount&#43;&#147;.&#148;);
            out.println(&#147;&ltBR&gt&#148;);

            session.putValue(&#147;sessioninfo.count&#148;
                               ,new Integer(intCount));

            out.println(&#147;Session ID: &#148; &#43; session.getId());
            out.println(&#147;&ltBR&gt&#148;);
            out.println(&#147;Creation Time: &#148;
                      &#43; (new Date(session.getCreationTime())));
            out.println(&#147;&ltBR&gt&#148;);
            out.println(&#147;Last Accessed Time: &#148;
                      &#43; (new Date(session.getLastAccessedTime())));
            out.println(&#147;&ltBR&gt&#148;);

        <B>}</B>
        out.println(&#147;&ltA HREF=\&#148;&#147;);
        out.println(response.encodeUrl(request.getServletPath()));
        out.println(&#147;\&#148;&gt&#147;);
        out.println(&#147;Press Here&#148;);
        out.println(&#147;&lt/A&gt&#148;);
        out.println(&#147;To reload the page, with url encoding.&#148;);
        out.println(&#147;&lt/BODY&gt&#148;);
        out.println(&#147;&lt/HTML&gt&#148;);
        out.close();
    }

}
</PRE>
<!-- END CODE //-->
<P>If you try this servlet, you will find that reloading the Web page increments the counter and updates the last accessed time. Also, if you leave the servlet alone long enough&#151;about 10 to 30 minutes&#151;the session expires, and the next time you access it, you will get a new counter. This expiration time is usually configurable by the server administrator.
</P>
<H4 ALIGN="LEFT"><A NAME="Heading14"></A><FONT COLOR="#000077">Cookies</FONT></H4>
<P>Sessions provide a method for storing data about a current user interaction, but they are not intended for storing information permanently. <I>Cookies,</I> on the other hand, are key-value pairs that a servlet can associate with a client and that can have an arbitrary expiration time. The drawbacks for cookies are threefold. First, they can only be strings. Second, cookies are stored on the client, so they take up client disk space; as a result most browsers limit their number and size. As a guideline, each server can assign 20 or so cookies to the client, with a total size of 4K. Finally, cookies have to be sent over the Internet with each request. In HTTP, the cookies are part of the header for a request and reply.</P>
<P><A NAME="Fig4"></A><A HREF="javascript:displayWindow('images/07-04.jpg',715,447 )"><IMG SRC="images/07-04t.jpg"></A>
<BR><A HREF="javascript:displayWindow('images/07-04.jpg',715,447)"><FONT COLOR="#000077"><B>Figure 7.4</B></FONT></A>&nbsp;&nbsp;First time to servlet.</P>
<P><A NAME="Fig5"></A><A HREF="javascript:displayWindow('images/07-05.jpg',715,447 )"><IMG SRC="images/07-05t.jpg"></A>
<BR><A HREF="javascript:displayWindow('images/07-05.jpg',715,447)"><FONT COLOR="#000077"><B>Figure 7.5</B></FONT></A>&nbsp;&nbsp;Subsequent access to servlet.</P>
<P>The good thing about cookies is that they are easy to program, are flexible, and can be used to store small pieces of information about a particular program on the client&#146;s machine, thus freeing up server resources. Cookies are also associated with a specific server and path, preventing other servers from reading the information they contain. Cookies can be assigned expiration dates, making them persist between sessions. The servlet library uses the class Cookie to represent the cookies provided with an HttpRequest or returned with a response. Table 7.15 shows the methods provided by Cookie.
</P>
<P>To determine the cookies for a request, use the HttpServletRequest object&#146;s getCookies method. This returns an array of Cookie objects. To associate cookies with the response, use the HttpServletResponse method addCookie. This call should always happen before you send HTML to the client, because the HTML body may force the HTTP header to be sent, and the cookie must be part of the header. If you have cookies from the response that you want to return to the client, add them using addCookie as well.</P><P><BR></P>
<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="07-09.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="07-11.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


<!-- 