
<SCRIPT>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
	',height=' + height + ',resizable=1,scrollbars=yes');
	}
	//-->
	</SCRIPT>



<FONT FACE="Arial,Helvetica" SIZE="-1">
To access the contents, click the chapter and section titles.
</FONT>
<P>
<B>Developing Java Enterprise Applications</B>
<FONT SIZE="-1">
<BR>
<I>(Publisher: John Wiley & Sons, Inc.)</I>
<BR>
Author(s): Stephen Asbury ; Scott R. Weiner
<BR>
ISBN: 0471327565
<BR>
Publication Date: 02/01/99
</FONT>
<P>
<Script language="JavaScript">
function isIE4() 
{
    return( navigator.appName.indexOf("Microsoft") != -1 && (navigator.appVersion.charAt(0)=='4') );
 }
function bookMarkit()
{
        var url="http://www.itknowledge.com/PSUser/EWBookMarks.html?url="+window.location+"&isbn=0";
	parent.location.href=url;
        //var win = window.open(url,"myitk");
        //if(!isIE4())
        //       win.focus();

}
</Script>
<a href="javascript:bookMarkit();"><img src="/images/bookmarkit.gif" border=0 alt="Bookmark It" width=97 height=23></a>

<P>
<form name="Search" method="GET" action="http://search.earthweb.com/search97/search_redir.cgi">

<INPUT TYPE="hidden" NAME="Action" VALUE="Search">
<INPUT TYPE="hidden" NAME="SearchPage" VALUE="http://search.earthweb.com/search97/samples/forms/srchdemo.htm">
<INPUT TYPE="hidden" NAME="Collection" VALUE="ITK">
<INPUT TYPE="hidden" NAME="ResultTemplate" VALUE="itk-simple-intrabook.hts">
<INPUT TYPE="hidden" NAME="ViewTemplate" VALUE="view.hts">

<font face="arial, helvetica" size=2><b>Search this book:</b></font><br>
<INPUT NAME="queryText" size=50 VALUE="">&nbsp;<input type="submit" name="submitbutton" value="Go!">
<INPUT type=hidden NAME="section_on" VALUE="on">
<INPUT type=hidden NAME="section" VALUE="http://www.itknowledge.com/reference/standard/0471327565/">

</form>


<!-- Empty Reference Subhead -->

<!--ISBN=0471327565//-->
<!--TITLE=Developing Java Enterprise Applications//-->
<!--AUTHOR=Stephen Asbury//-->
<!--AUTHOR=Scott R. Weiner//-->
<!--PUBLISHER=Wiley Computer Publishing//-->
<!--CHAPTER=07//-->
<!--PAGES=162-166//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="07-06.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="07-08.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<P><BR></P>
<P>HttpServletRequest also adds new functionality to the request object for managing session information. Sessions are discussed in detail under the heading &#147;HttpSessions,&#148; but for now notice the methods for managing the session id and session object.
</P>
<P>As an example of the information provided by the request object, we have created a servlet that displays the headers, parameters, and information from the request back to the client. Notice that depending on your environment, some of these methods may not work successfully. See the section on &#147;Debugging Servlets&#148; for more information on how to find these errors. The results of running this servlet are pictured in Figure 7.2. The input from a form was included, along with the environmental information. All of the code for this example is included in the single-class PrintEnvServlet that extends HttpServlet. The service method is implemented to print information from the request in an HTML page and return the HTML to the client.</P>
<!-- CODE //-->
<PRE>
import java.io.*;
import java.util.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class PrintEnvServlet extends HttpServlet
{
    public void service(HttpServletRequest request,
                        HttpServletResponse response)
                        throws ServletException, IOException
    {
        PrintWriter    out;
        Enumeration headers;

        String curHeader;
</PRE>
<!-- END CODE //-->
<P>The content type for a servlet&#146;s response is set using the response object. In this case, we will return HTML, which has the MIME type text/html. Once the content type is set, the servlet prints the beginning of the HTML page.
</P>
<!-- CODE SNIP //-->
<PRE>
        response.setContentType(&#147;text/html&#148;);

        out = response.getWriter();

        out.println(&#147;&ltHTML&gt&ltHEAD&gt&ltTITLE&gt&#148;);
        out.println(&#147;Print Environment&#148;);
        out.println(&#147;&lt/TITLE&gt&lt/HEAD&gt&ltBODY&gt&#148;);
</PRE>
<!-- END CODE SNIP //-->
<P>Next, the servlet uses the HttpUtils class and the request object to recreate the exact URL used by the client to access the servlet. For example, this code constructs a string such as <A HREF="http://zero:8080/servlet/printer">http://zero:8080/servlet/printer</A>.</P>
<!-- CODE SNIP //-->
<PRE>
        out.println(&#147;&ltH1&gtRequested URL&lt/H1&gt&#148;);
        out.println(HttpUtils.getRequestURL(request).toString());
        out.println(&#147;&ltBR&gt&#148;);
</PRE>
<!-- END CODE SNIP //-->
<P>After printing the request URL, the servlet prints all of the header fields in the request and their associated values.
</P>
<!-- CODE //-->
<PRE>
        out.println(&#147;&ltH1&gtHeaders&lt/H1&gt&#148;);

        headers = request.getHeaderNames();

        while(headers.hasMoreElements())
        {
            curHeader = (String) headers.nextElement();

            out.println(curHeader
                        &#43;&#147;=&#148;&#43;request.getHeader(curHeader)&#43;&#147;&ltBR&gt&#148;);

        }
</PRE>
<!-- END CODE //-->
<P>HttpServletRequest provides a number of direct methods for accessing information about a request. The following code displays all of these values with their corresponding names. Table 7.11 describes the meaning of each value. Some of these values overlay the headers printed above.
</P>
<!-- CODE //-->
<PRE>
        out.println(&#147;&ltBR&gt&#148;);
        out.println(&#147;&ltH1&gtRequest Information&lt/H1&gt&#148;);

        try
        {
            out.println(&#147;AuthType=&#148;&#43;request.getAuthType()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Scheme=&#148;&#43;request.getScheme()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Method=&#148;&#43;request.getMethod()&#43;&#147;&ltBR&gt&#148;);

        //Crashes on some servers.
        //  out.println(&#147;Char Encoding=&#148;
                        &#43;request.getCharacterEncoding()&#43;&#147;&ltBR&gt&#148;);

            out.println(&#147;Request URI=&#148;
                         &#43;request.getRequestURI()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Request protocol=&#148;
                         &#43;request.getProtocol()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Servlet path=&#148;
                         &#43;request.getServletPath()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Path Info=&#148;&#43;request.getPathInfo()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Path Translated=&#148;
                         &#43;request.getPathTranslated()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Query String=&#148;
                         &#43;request.getQueryString()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Content length=&#148;
                         &#43;request.getContentLength()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Content type=&#148;
                         &#43;request.getContentType()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Server name=&#148;
                         &#43;request.getServerName()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Server port=&#148;
                         &#43;request.getServerPort()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Remote user=&#148;
                         &#43;request.getRemoteUser()&#43;&#147;&ltBR&gt&#148;);
            out.println(&#147;Remote address=&#148;
                         &#43;request.getRemoteAddr()&#43;&#147;&ltBR&gt&#148;);

        //Times out if no DNS.
        //    out.println(&#147;Remote host=&#148;
                            &#43;request.getRemoteHost()&#43;&#147;&ltBR&gt&#148;);
        }
        catch(Exception exp)
        {
            out.println(&#147;Exception: &#148;&#43;exp&#43;&#147;&ltBR&gt&#148;);

        }
</PRE>
<!-- END CODE //-->
<P>Next, the servlet checks any parameters and prints them. These will be defined by forms or manually by the HTML and browser. Parameters can be single valued or multivalued. This code checks for both and, if the parameter is multivalued, prints a list. Otherwise, a single string is printed.
</P>
<!-- CODE //-->
<PRE>
        out.println(&#147;&ltBR&gt&ltH1&gtParameter Information&lt/H1&gt&#148;);

        Enumeration parameters;
        String[] values;
        String curParam;
        String value;
        int i,max;

        parameters = request.getParameterNames();

        while(parameters.hasMoreElements())
        {
            curParam = (String) parameters.nextElement();

            values = request.getParameterValues(curParam);
            value = request.getParameter(curParam);

            out.println(curParam&#43;&#147;=&ltBR&gt&ltUL&gt&#148;);

            if((values != null)&amp&amp(values.length&gt1))
            {
                max = values.length;

                for(i=0;i&ltmax;i&#43;&#43;)
                {
                    out.println(&#147;&ltLI&gt&#148;&#43;values[i]);
                }
            }
            else if(value != null)
            {
                out.println(&#147;&ltLI&gt&#148;&#43;value);
            }

            out.println(&#147;&lt/UL&gt&#148;);

        }
</PRE>
<!-- END CODE //-->
<P>Finally, the HTML page is concluded, and the output stream to the client is closed.
</P>
<!-- CODE SNIP //-->
<PRE>
        out.println(&#147;&lt/BODY&gt&lt/HTML&gt&#148;);

        out.close();
    }

}
</PRE>
<!-- END CODE SNIP //-->
<P>The HTML page shown activates the servlet. Notice that the form action URL has extra path information passed in order to show, in the servlet and in the output, how this information is passed to the servlet and processed as PathInfo data. A list of options is also provided in order to show how multivalued input is handled.
</P>
<!-- CODE //-->
<PRE>
&ltHTML&gt
&ltHEAD&gt
&ltTITLE&gt
Print Env Form
&lt/TITLE&gt
&lt/HEAD&gt
&ltBODY&gt
&ltFORM METHOD=POST
    ACTION=&#147;/servlet/printenvservlet/xtrapathinfo&#148;&gt

&ltINPUT NAME=&#147;Field&#148; VALUE=&#147;Field Value&#148;&gt&ltBR&gt
&ltSELECT SIZE=2 NAME=&#147;List&#148; MULTIPLE&gt
&ltOPTION NAME=&#147;ListItem1&#148; VALUE=&#147;Item One&#148; SELECT&gtItem One
&ltOPTION NAME=&#147;ListItem2&#148; VALUE=&#147;Item Two&#148; SELECT&gtItem Two
&ltOPTION NAME=&#147;ListItem3&#148; VALUE=&#147;Item Three&#148;&gtItem Three
&lt/SELECT&gt&ltBR&gt
&ltINPUT TYPE=&#147;Submit&#148; NAME=&#147;Submit&#148; VALUE=&#147;Go&#148;&gt

&lt/FORM&gt
&lt/BODY&gt

&lt/HTML&gt
</PRE>
<!-- END CODE //-->
<P>On the CD-ROM, this file is called PrintEnvTester.html. When used, it results in a page like the one pictured in Figure 7.2.
</P>
<P>This section demonstrated how the request object can be used to process client input. The next section demonstrates how the response object can be used to output results to the client.</P><P><BR></P>
<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="07-06.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="07-08.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


<!-- 