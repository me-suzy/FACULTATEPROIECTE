
<SCRIPT>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
	',height=' + height + ',resizable=1,scrollbars=yes');
	}
	//-->
	</SCRIPT>



<FONT FACE="Arial,Helvetica" SIZE="-1">
To access the contents, click the chapter and section titles.
</FONT>
<P>
<B>Developing Java Enterprise Applications</B>
<FONT SIZE="-1">
<BR>
<I>(Publisher: John Wiley & Sons, Inc.)</I>
<BR>
Author(s): Stephen Asbury ; Scott R. Weiner
<BR>
ISBN: 0471327565
<BR>
Publication Date: 02/01/99
</FONT>
<P>
<Script language="JavaScript">
function isIE4() 
{
    return( navigator.appName.indexOf("Microsoft") != -1 && (navigator.appVersion.charAt(0)=='4') );
 }
function bookMarkit()
{
        var url="http://www.itknowledge.com/PSUser/EWBookMarks.html?url="+window.location+"&isbn=0";
	parent.location.href=url;
        //var win = window.open(url,"myitk");
        //if(!isIE4())
        //       win.focus();

}
</Script>
<a href="javascript:bookMarkit();"><img src="/images/bookmarkit.gif" border=0 alt="Bookmark It" width=97 height=23></a>

<P>
<form name="Search" method="GET" action="http://search.earthweb.com/search97/search_redir.cgi">

<INPUT TYPE="hidden" NAME="Action" VALUE="Search">
<INPUT TYPE="hidden" NAME="SearchPage" VALUE="http://search.earthweb.com/search97/samples/forms/srchdemo.htm">
<INPUT TYPE="hidden" NAME="Collection" VALUE="ITK">
<INPUT TYPE="hidden" NAME="ResultTemplate" VALUE="itk-simple-intrabook.hts">
<INPUT TYPE="hidden" NAME="ViewTemplate" VALUE="view.hts">

<font face="arial, helvetica" size=2><b>Search this book:</b></font><br>
<INPUT NAME="queryText" size=50 VALUE="">&nbsp;<input type="submit" name="submitbutton" value="Go!">
<INPUT type=hidden NAME="section_on" VALUE="on">
<INPUT type=hidden NAME="section" VALUE="http://www.itknowledge.com/reference/standard/0471327565/">

</form>


<!-- Empty Reference Subhead -->

<!--ISBN=0471327565//-->
<!--TITLE=Developing Java Enterprise Applications//-->
<!--AUTHOR=Stephen Asbury//-->
<!--AUTHOR=Scott R. Weiner//-->
<!--PUBLISHER=Wiley Computer Publishing//-->
<!--CHAPTER=07//-->
<!--PAGES=177-181//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="07-10.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="07-12.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<P><BR></P>
<P>The following code example implements a basic counter using a cookie. Another cookie is assigned to track the initial time that the first cookie was assigned. This second cookie doesn&#146;t change, but it needs to be reassigned to the response to ensure its continued existence. The code for creating and adding the cookies is highlighted to draw attention to it. The surrounding code is used to increment over the list of available cookies and display a page to the user, indicating the results as pictured in Figure 7.6.
</P>
<!-- CODE SNIP //-->
<PRE>
import java.io.*;
import java.net.*;
</PRE>
<!-- END CODE SNIP //-->
<TABLE WIDTH="100%">
<TD CAPTION ALIGN="LEFT" COLSPAN="2"><B>Table 7.15</B> Cookie Methods
<TR>
<TD ALIGN="LEFT" VALIGN="TOP" COLSPAN="2"><HR>
<TR>
<TH WIDTH="30%" ALIGN="LEFT" VALIGN="TOP">METHOD
<TH WIDTH="70%" ALIGN="LEFT" VALIGN="TOP">DESCRIPTION
<TR>
<TD ALIGN="LEFT" VALIGN="TOP" COLSPAN="2"><HR>
<TR>
<TD ALIGN="LEFT" VALIGN="TOP"><SMALL>String getComment()</SMALL>
<TD ALIGN="LEFT" VALIGN="TOP">Returns the comment describing the purpose of this cookie or null.
<TR>
<TD ALIGN="LEFT" VALIGN="TOP" COLSPAN="2"><HR>
<TR>
<TD ALIGN="LEFT" VALIGN="TOP"><SMALL>String getDomain() </SMALL>
<TD ALIGN="LEFT" VALIGN="TOP">Returns the domain of this cookie. The cookie&#146;s domain indicates the set of computers that the cookie will be sent to. For example, if the domain is sun.com, the cookie will be sent only to sun.com computers.
<TR>
<TD ALIGN="LEFT" VALIGN="TOP" COLSPAN="2"><HR>
<TR>
<TD ALIGN="LEFT" VALIGN="TOP"><SMALL>int getMaxAge()</SMALL>
<TD ALIGN="LEFT" VALIGN="TOP">Returns the maximum specified age of the cookie in seconds.
<TR>
<TD ALIGN="LEFT" VALIGN="TOP" COLSPAN="2"><HR>
<TR>
<TD ALIGN="LEFT" VALIGN="TOP"><SMALL>String getName() </SMALL>
<TD ALIGN="LEFT" VALIGN="TOP">Returns the name of the cookie.
<TR>
<TD ALIGN="LEFT" VALIGN="TOP" COLSPAN="2"><HR>
<TR>
<TD ALIGN="LEFT" VALIGN="TOP"><SMALL>String getPath() </SMALL>
<TD ALIGN="LEFT" VALIGN="TOP">Returns the prefix of all URLs for which this cookie is targeted. For example, if the cookie is for only <A HREF="http://sun.com/servlet/cookiecounter">http://sun.com/servlet/cookiecounter</A>, the path is /servlet/cookiecounter. Subdirectories will also see the cookie, but parent and sibling directories will not.
<TR>
<TD ALIGN="LEFT" VALIGN="TOP" COLSPAN="2"><HR>
<TR>
<TD ALIGN="LEFT" VALIGN="TOP"><SMALL>boolean getSecure() </SMALL>
<TD ALIGN="LEFT" VALIGN="TOP">Returns the value of the secure flag. If the cookie is secure, it will be sent over only secure channels such as https, not over standard http.
<TR>
<TD ALIGN="LEFT" VALIGN="TOP" COLSPAN="2"><HR>
<TR>
<TD ALIGN="LEFT" VALIGN="TOP"><SMALL>String getValue() </SMALL>
<TD ALIGN="LEFT" VALIGN="TOP">Returns the value of the cookie.
<TR>
<TD ALIGN="LEFT" VALIGN="TOP" COLSPAN="2"><HR>
<TR>
<TD ALIGN="LEFT" VALIGN="TOP"><SMALL>void setComment(String) </SMALL>
<TD ALIGN="LEFT" VALIGN="TOP">Used by the Web browser to indicate its purpose to the user.
<TR>
<TD ALIGN="LEFT" VALIGN="TOP" COLSPAN="2"><HR>
<TR>
<TD ALIGN="LEFT" VALIGN="TOP"><SMALL>void setDomain(String) </SMALL>
<TD ALIGN="LEFT" VALIGN="TOP">Sets the cookie&#146;s domain.
<TR>
<TD ALIGN="LEFT" VALIGN="TOP" COLSPAN="2"><HR>
<TR>
<TD ALIGN="LEFT" VALIGN="TOP"><SMALL>void setMaxAge(int) </SMALL>
<TD ALIGN="LEFT" VALIGN="TOP">Sets the cookie&#146;s maximum age in seconds. A negative value tells the cookie that it should persist for only the current session. Zero means that the cookie should be deleted. A positive number indicates the time, in seconds, for which the cookie should persist.
<TR>
<TD ALIGN="LEFT" VALIGN="TOP" COLSPAN="2"><HR>
<TR>
<TD ALIGN="LEFT" VALIGN="TOP"><SMALL>void setPath(String) </SMALL>
<TD ALIGN="LEFT" VALIGN="TOP">Sets the cookie&#146;s path as described above.
<TR>
<TD ALIGN="LEFT" VALIGN="TOP" COLSPAN="2"><HR>
<TR>
<TD ALIGN="LEFT" VALIGN="TOP"><SMALL>void setSecure(boolean) </SMALL>
<TD ALIGN="LEFT" VALIGN="TOP">Turns the secure flag on and off.
<TR>
<TD ALIGN="LEFT" VALIGN="TOP" COLSPAN="2"><HR>
<TR>
<TD ALIGN="LEFT" VALIGN="TOP"><SMALL>void setValue(String) </SMALL>
<TD ALIGN="LEFT" VALIGN="TOP">Sets cookie&#146;s value.
<TR>
<TD ALIGN="LEFT" VALIGN="TOP" COLSPAN="2"><HR>
</TABLE>
<!-- CODE //-->
<PRE>
import java.util.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class CookieCounterServlet extends HttpServlet
{
    public void doGet(HttpServletRequest request,
                      HttpServletResponse response)
    throws ServletException, IOException
    {
        response.setContentType(&#147;text/html&#148;);
        PrintWriter out = response.getWriter();

<B>        //Get list of current cookie values from request object.
        Cookie cookies[] = request.getCookies();
</B>        int i,max=0;
        String countStr=null;
        String createStr = null;
        Cookie curCookie=null;
        Cookie countCookie=null;

        if(cookies != null) max = cookies.length;

        for(i=0;i&ltmax;i&#43;&#43;)
        {
            curCookie = cookies[i];

            if(&#147;count&#148;.equals(curCookie.getName()))
            {
                countStr = curCookie.getValue();
                countCookie = curCookie;
            }
            else if(&#147;create&#148;.equals(curCookie.getName()))
            {
                createStr =
                    URLDecoder.decode(curCookie.getValue());
                //Don&#146;t change just re-add
<B>                response.addCookie(curCookie);</B>
            }
            else
            {
<B>                response.addCookie(curCookie);
</B>            }
        }

        //Set the cookie first, since it goes in the header.
        if((countStr == null)||(countCookie == null))
        {
            countStr = &#147;0&#148;;
<B>            curCookie = new Cookie(&#147;count&#148;,countStr);
            response.addCookie(curCookie);
</B>
            createStr = (new Date()).toString();
            createStr = URLEncoder.encode(createStr);

<B>            curCookie = new Cookie(&#147;create&#148;
                                    ,createStr);
</B>
            createStr = URLDecoder.decode(createStr);
<B>            response.addCookie(curCookie);
</B>        }
        else
        {
            int intCount=0;

            intCount = Integer.parseInt(countStr) &#43; 1;
            countStr = String.valueOf(intCount);
            countCookie.setValue(countStr);

<B>            response.addCookie(countCookie);
</B>        }

        out.println(&#147;&ltHTML&gt&#148;);
        out.println(&#147;&ltHEAD&gt&#148;);
        out.println(&#147;&ltTITLE&gt&#148;);
        out.println(&#147;Cookie Counter Servlet&#148;);
        out.println(&#147;&lt/TITLE&gt&#148;);
        out.println(&#147;&lt/HEAD&gt&#148;);
        out.println(&#147;&ltBODY&gt&#148;);

        out.println(&#147;The count is set to &#148;&#43;countStr&#43;&#147;.&#148;);
        out.println(&#147;&ltBR&gt&#148;);
        out.println(&#147;The creation time was &#148;&#43;createStr&#43;&#147;.&#148;);
        out.println(&#147;&lt/BODY&gt&#148;);
        out.println(&#147;&lt/HTML&gt&#148;);
        out.close();
    }

}
</PRE>
<!-- END CODE //-->
<P><A NAME="Fig6"></A><A HREF="javascript:displayWindow('images/07-06.jpg',715,447 )"><IMG SRC="images/07-06t.jpg"></A>
<BR><A HREF="javascript:displayWindow('images/07-06.jpg',715,447)"><FONT COLOR="#000077"><B>Figure 7.6</B></FONT></A>&nbsp;&nbsp;Cookie servlet results page.</P>
<P>To ensure that the data sent in the cookie referenced in this code is valid HTTP style data, it is encoded with the URLEncoder class provided in java.net. However, we must write our own URLDecoder to recover the original data string. This class is provided on the CD-ROM.
</P>
<P>Because cookies are limited by the client, keep in mind the total use of cookies by your Web server, including session ids, when adding new cookies to the list. One interesting use of cookies&#151;and a way around the size limitations&#151;is to create your own sessions by creating ids and storing them in cookies. Associate the ids with data in a file or in the database. This allows the session to be persistent with the session id on the client and the session information on the server.</P><P><BR></P>
<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="07-10.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="07-12.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


<!-- 