
<SCRIPT>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
	',height=' + height + ',resizable=1,scrollbars=yes');
	}
	//-->
	</SCRIPT>



<FONT FACE="Arial,Helvetica" SIZE="-1">
To access the contents, click the chapter and section titles.
</FONT>
<P>
<B>Developing Java Enterprise Applications</B>
<FONT SIZE="-1">
<BR>
<I>(Publisher: John Wiley & Sons, Inc.)</I>
<BR>
Author(s): Stephen Asbury ; Scott R. Weiner
<BR>
ISBN: 0471327565
<BR>
Publication Date: 02/01/99
</FONT>
<P>
<Script language="JavaScript">
function isIE4() 
{
    return( navigator.appName.indexOf("Microsoft") != -1 && (navigator.appVersion.charAt(0)=='4') );
 }
function bookMarkit()
{
        var url="http://www.itknowledge.com/PSUser/EWBookMarks.html?url="+window.location+"&isbn=0";
	parent.location.href=url;
        //var win = window.open(url,"myitk");
        //if(!isIE4())
        //       win.focus();

}
</Script>
<a href="javascript:bookMarkit();"><img src="/images/bookmarkit.gif" border=0 alt="Bookmark It" width=97 height=23></a>

<P>
<form name="Search" method="GET" action="http://search.earthweb.com/search97/search_redir.cgi">

<INPUT TYPE="hidden" NAME="Action" VALUE="Search">
<INPUT TYPE="hidden" NAME="SearchPage" VALUE="http://search.earthweb.com/search97/samples/forms/srchdemo.htm">
<INPUT TYPE="hidden" NAME="Collection" VALUE="ITK">
<INPUT TYPE="hidden" NAME="ResultTemplate" VALUE="itk-simple-intrabook.hts">
<INPUT TYPE="hidden" NAME="ViewTemplate" VALUE="view.hts">

<font face="arial, helvetica" size=2><b>Search this book:</b></font><br>
<INPUT NAME="queryText" size=50 VALUE="">&nbsp;<input type="submit" name="submitbutton" value="Go!">
<INPUT type=hidden NAME="section_on" VALUE="on">
<INPUT type=hidden NAME="section" VALUE="http://www.itknowledge.com/reference/standard/0471327565/">

</form>


<!-- Empty Reference Subhead -->

<!--ISBN=0471327565//-->
<!--TITLE=Developing Java Enterprise Applications//-->
<!--AUTHOR=Stephen Asbury//-->
<!--AUTHOR=Scott R. Weiner//-->
<!--PUBLISHER=Wiley Computer Publishing//-->
<!--CHAPTER=20//-->
<!--PAGES=548-551//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="20-15.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="20-17.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<P><BR></P>
<TABLE WIDTH="100%">
<TR>
<TD CAPTION ALIGN="LEFT" COLSPAN="2"><B>Table 20.12</B> TopicPublisher Methods
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TH VALIGN="TOP" WIDTH="50%" ALIGN="LEFT">METHOD
<TH VALIGN="TOP" ALIGN="LEFT">DESCRIPTION
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT"><SMALL>public void publish(Message message) throws JMSException</SMALL>
<TD VALIGN="TOP" ALIGN="LEFT">Publish a method to the publisher&#146;s default topic with the default priority, timeToLive, and mode.
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT"><SMALL>public void publish(Message message, int deliveryMode, int priority, long timeToLive) throws JMSException</SMALL>
<TD VALIGN="TOP" ALIGN="LEFT">Publish a method to the publisher&#146;s default topic with the specified priority, timeToLive, and mode.
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT"><SMALL>public void publish(Topic topic, Message message) throws JMSException</SMALL>
<TD VALIGN="TOP" ALIGN="LEFT">Publish a method to the specified topic with the default priority, timeToLive, and mode.
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT"><SMALL>public void publish(Topic topic, Message message, int deliveryMode, int priority, long timeToLive) throws JMSException</SMALL>
<TD VALIGN="TOP" ALIGN="LEFT">Publish a method to the specified topic with the specified priority, timeToLive, and mode.
<TR>
<TD COLSPAN="2"><HR>
</TABLE>
<P><A NAME="Fig6"></A><A HREF="javascript:displayWindow('images/20-06.jpg',374,95 )"><IMG SRC="images/20-06t.jpg"></A>
<BR><A HREF="javascript:displayWindow('images/20-06.jpg',374,95)"><FONT COLOR="#000077"><B>Figure 20.6</B></FONT></A>&nbsp;&nbsp;Topic publisher test.</P>
<!-- CODE //-->
<PRE>
import javax.jms.*;
import javax.naming.*;
import minijms.*;

import com.sun.java.swing.*;
import java.awt.*;
import java.awt.event.*;

public class TopicPublisherTest extends JPanel
 implements ActionListener
{
    JTextField sendField;
    JTextField topicField;

    javax.jms.TopicSession session;
    javax.jms.TopicPublisher sender;
    javax.jms.TopicConnection conn;
    javax.jms.TopicConnectionFactory factory;

    public static final String send_action=&#147;send&#148;;
    public static final String topic_action=&#147;topic&#148;;
</PRE>
<!-- END CODE //-->
<P>The constructor for TopicPublisherTest creates the user interface and the initial object for accessing JMS. The MiniJMSUtils class, described in &#147;MiniJMSUtils&#148; at the beginning of the chapter, is used to create the JNDI context for this program.
</P>
<!-- CODE //-->
<PRE>
    public TopicPublisherTest(String user)
    {
        JLabel label;
        JButton button;
        JPanel tmp;
        Context context;
        Font f = new Font(&#147;Serif&#148;,Font.PLAIN,16);

        setFont(f);

        try
        {
            <B>MiniJMSUtils.init(&#147;topicpublisher.properties&#148;);
            context = MiniJMSUtils.context;

            factory
             = (TopicConnectionFactory)
                 context.lookup(&#147;TopicConnectionFactory&#148;);

            conn
             = factory.createTopicConnection(user,null);

            session

             = conn.createTopicSession(false
                      ,Session.AUTO_ACKNOWLEDGE);</B>

            if(session == null) throw new Exception();
        }
        catch(Exception exp)
        {
            exp.printStackTrace();
            System.exit(0);
        }

        setLayout(new GridLayout(2,1,6,6));

        topicField = new JTextField(20);
        topicField.addActionListener(this);
        topicField.setActionCommand(topic_action);

        label = new JLabel(&#147;Topic:&#148;);

        button = new JButton(&#147;Change&#148;);
        button.addActionListener(this);
        button.setActionCommand(topic_action);

        tmp = new JPanel();
        tmp.setLayout(new FlowLayout(FlowLayout.LEFT,6,0));

        label.setFont(f);
        topicField.setFont(f);
        button.setFont(f);

        tmp.add(label);
        tmp.add(topicField);
        tmp.add(button);

        add(tmp);
        sendField = new JTextField(20);
        sendField.addActionListener(this);
        sendField.setActionCommand(send_action);

        label = new JLabel(&#147;Message:&#148;);

        button = new JButton(&#147;Send&#148;);

        button.addActionListener(this);
        button.setActionCommand(send_action);

        tmp = new JPanel();
        tmp.setLayout(new FlowLayout(FlowLayout.LEFT,6,0));

        label.setFont(f);
        sendField.setFont(f);
        button.setFont(f);

        tmp.add(label);
        tmp.add(sendField);
        tmp.add(button);

        add(tmp);
    }
</PRE>
<!-- END CODE //-->
<P>The setTopic method is called when the user changes the program&#146;s target topic. Once the topic is looked up in JNDI, a new publisher is created for it. The old publisher, if it exists, is closed to minimize resource usage.
</P>
<!-- CODE //-->
<PRE>
    public void setTopic(String name)
    {
        Topic topic=null;

        try
        {
            if(sender!=null) sender.close();
            <B>topic
             = (Topic) MiniJMSUtils.context.lookup(name);

            sender = session.createPublisher(topic);</B>

            if((topic == null)
                ||(sender==null)) throw new Exception();
        }
        catch(Exception exp)
        {
            exp.printStackTrace();
            System.exit(0);
        }
    }
</PRE>
<!-- END CODE //-->
<P>The sendMessage method takes a string, assigns it to a TextMessage, and publishes the message.
</P>
<!-- CODE //-->
<PRE>
    public void sendMessage(String text)
    {
        TextMessage msg;

        try

        {
                <B>msg = session.createTextMessage();
                msg.setText(text);
                sender.publish(msg);</B>
        }
        catch(Exception exp)
        {
            JOptionPane.showMessageDialog(this
                                     ,exp.toString()
                                     ,&#147;Send Error&#148;
                                     ,JOptionPane.ERROR_MESSAGE);
        }
    }
</PRE>
<!-- END CODE //-->
<P>The actionPerformed method handles user interaction with the buttons and text fields. It calls setTopic and sendMessage appropriately.
</P>
<!-- CODE //-->
<PRE>
    public void actionPerformed(ActionEvent evt)
    {
        String cmd = evt.getActionCommand();

        if(send_action.equals(cmd))
        {
            sendMessage(sendField.getText());
        }
        else if(topic_action.equals(cmd))
        {
            setTopic(topicField.getText());
        }
    }
</PRE>
<!-- END CODE //-->
<P>Close is called when the window closes and cleans up the JMS objects that were created.
</P>
<!-- CODE //-->
<PRE>
    public void close()
    {
        try
        {
            sender.close();
            session.close();
            conn.close();
        }
        catch(Exception exp)
        {
            exp.printStackTrace();
        }
    }
</PRE>
<!-- END CODE //-->
<P><BR></P>
<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="20-15.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="20-17.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


<!-- 