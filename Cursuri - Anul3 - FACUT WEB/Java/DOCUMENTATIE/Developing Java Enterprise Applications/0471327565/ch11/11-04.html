
<SCRIPT>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
	',height=' + height + ',resizable=1,scrollbars=yes');
	}
	//-->
	</SCRIPT>



<FONT FACE="Arial,Helvetica" SIZE="-1">
To access the contents, click the chapter and section titles.
</FONT>
<P>
<B>Developing Java Enterprise Applications</B>
<FONT SIZE="-1">
<BR>
<I>(Publisher: John Wiley & Sons, Inc.)</I>
<BR>
Author(s): Stephen Asbury ; Scott R. Weiner
<BR>
ISBN: 0471327565
<BR>
Publication Date: 02/01/99
</FONT>
<P>
<Script language="JavaScript">
function isIE4() 
{
    return( navigator.appName.indexOf("Microsoft") != -1 && (navigator.appVersion.charAt(0)=='4') );
 }
function bookMarkit()
{
        var url="http://www.itknowledge.com/PSUser/EWBookMarks.html?url="+window.location+"&isbn=0";
	parent.location.href=url;
        //var win = window.open(url,"myitk");
        //if(!isIE4())
        //       win.focus();

}
</Script>
<a href="javascript:bookMarkit();"><img src="/images/bookmarkit.gif" border=0 alt="Bookmark It" width=97 height=23></a>

<P>
<form name="Search" method="GET" action="http://search.earthweb.com/search97/search_redir.cgi">

<INPUT TYPE="hidden" NAME="Action" VALUE="Search">
<INPUT TYPE="hidden" NAME="SearchPage" VALUE="http://search.earthweb.com/search97/samples/forms/srchdemo.htm">
<INPUT TYPE="hidden" NAME="Collection" VALUE="ITK">
<INPUT TYPE="hidden" NAME="ResultTemplate" VALUE="itk-simple-intrabook.hts">
<INPUT TYPE="hidden" NAME="ViewTemplate" VALUE="view.hts">

<font face="arial, helvetica" size=2><b>Search this book:</b></font><br>
<INPUT NAME="queryText" size=50 VALUE="">&nbsp;<input type="submit" name="submitbutton" value="Go!">
<INPUT type=hidden NAME="section_on" VALUE="on">
<INPUT type=hidden NAME="section" VALUE="http://www.itknowledge.com/reference/standard/0471327565/">

</form>


<!-- Empty Reference Subhead -->

<!--ISBN=0471327565//-->
<!--TITLE=Developing Java Enterprise Applications//-->
<!--AUTHOR=Stephen Asbury//-->
<!--AUTHOR=Scott R. Weiner//-->
<!--PUBLISHER=Wiley Computer Publishing//-->
<!--CHAPTER=11//-->
<!--PAGES=302-307//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="11-03.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="11-05.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<P><BR></P>
<!-- CODE //-->
<PRE>
public class ShoppingCartItem
 {
    public String desc;
    public float price;
    public int quantity;
    
    public ShoppingCartItem(String s,float p,int q)
    {
        desc = s;
        price = p;
        quantity = q;
    }
    
   public float getTotal()
     {
        return quantity*price;
    }
}
</PRE>
<!-- END CODE //-->
<P><A NAME="Fig4"></A><A HREF="javascript:displayWindow('images/11-04.jpg',673,618 )"><IMG SRC="images/11-04t.jpg"></A>
<BR><A HREF="javascript:displayWindow('images/11-04.jpg',673,618)"><FONT COLOR="#000077"><B>Figure 11.4</B></FONT></A>&nbsp;&nbsp;A full cart.</P>
<P>The servlet that implements the shopping cart supports four primitive actions. First, it displays the cart. Second, it adds items to the cart. Third, it removes items from the cart. Fourth, the servlet adjusts the quantity of a specific item. In the case of adding, removing, or adjusting, the quantity value of the appropriate shopping cart item is changed. If the item being added is new, a new shopping cart item is created. If the quantity of an item goes to zero, the item is completely removed.
</P>
<P>After each request, the shopping cart servlet displays the current cart. This Web page, pictured in Figure 11.5, provides a text field for altering the number of items of a particular type in the cart or deleting items from the cart. Keep in mind that this servlet was created for educational purposes, and a real shopping cart would probably provide a more stylish interface.</P>
<P>The shopping cart servlet is implemented as a subclass of HttpServlet called ShoppingCartServlet. The code for this servlet is provided below. Most of the work is managed in the doGet method, with a separate method for drawing the entry for each item in the cart. A table is used to organize the items and display a total at the bottom of the list. A form is used to provide actions for each item, where the target of the form is the servlet itself. This servlet supports four inputs: an action that can add, adjust, delete, or view; an item that is a text description of the item; a unit price; and a quantity, the number to affect.</P>
<P><A NAME="Fig5"></A><A HREF="javascript:displayWindow('images/11-05.jpg',673,618 )"><IMG SRC="images/11-05t.jpg"></A>
<BR><A HREF="javascript:displayWindow('images/11-05.jpg',673,618)"><FONT COLOR="#000077"><B>Figure 11.5</B></FONT></A>&nbsp;&nbsp;Shopping cart contents.</P>
<!-- CODE //-->
<PRE>
import java.io.*;
import java.util.*;
import javax.servlet.*;
import javax.servlet.http.*;

/**
 * This servlet supports four input parameters:
 * action: either add, adjust, delete, or view
 * item: a text description of the item
 * price: the items unit price
 * quantity: the number to affect
 *
 * When accessed, the servlet displays the current contents of the cart. 
 */
public class ShoppingCartServlet extends HttpServlet
{ 
</PRE>
<!-- END CODE //-->
<P>All of the servlet&#146;s behavior is implemented in doGet. The first action in this method is to declare variables, access the servlet&#146;s URL from the request object, get the user&#146;s session, and get the PrintWriter for output.
</P>
<!-- CODE //-->
<PRE>
    public void doGet(HttpServletRequest request, HttpServletResponse response)
     throws ServletException, IOException
    {
<B>        HttpSession session = request.getSession(true);
</B>        PrintWriter out;
        Hashtable items;
        Enumeration itemKeys;
        String action;
        int quantity=0;
        float price=0;
        float total=0;
        String desc=null;
        ShoppingCartItem item;
        String errorMessage = null;
        String requestURL = 
        
HttpUtils.getRequestURL(request).toString();
        
        
        response.setContentType("text/html");
        out = response.getWriter();
If this is a new session, the servlet adds a hash table that will 
contain the current shopper's items in it. If the session is not new, it
should already have this hash table.
<B>        if(session.isNew())
        {
            session.putValue(</B>"<B>shoppingcart.items</B>"<B>,new Hashtable());
        }
        
        items = (Hashtable) session.getValue(</B>"<B>shoppingcart.items</B>"<B>);</B>
</PRE>
<!-- END CODE //-->
<P>Next, the servlet checks to see which action was requested and initializes the possible values for the current order. These values include a description of the item to be purchased, the requested quantity, and the price. In some cases, these values will not be set; for example, they may not have a value if the user is trying to view his or her cart.
</P>
<!-- CODE //-->
<PRE>
<B>        action = request.getParameter(</B>"<B>action</B>"<B>);</B>
             
        try
        {
            desc = request.getParameter("item");
            price = 
            (new Float(request.getParameter("price"))).floatValue();
            quantity = 
             Integer.parseInt(request.getParameter("quantity"));
        }
        catch(Exception exp)
        {
            //reset and don't do anything
            desc = null;
        }
</PRE>
<!-- END CODE //-->
<P>A series of if-else statements is used to handle the various actions. The first action to handle is adding items to the cart. In this case, the servlet checks to see whether the user is adding more of an existing item or adding a new item. Each item is represented by an instance of ShoppingCartItem that has a quantity associated with it. Adding more existing items to a cart simply adjusts the value of this quantity variable. Truly new items result in the creation of a new ShoppingCartItem. This new item is added to the items hash table being stored in the user&#146;s session.
</P>
<!-- CODE //-->
<PRE>
        <B>if(</B>"<B>add</B>"<B>.equalsIgnoreCase(action))</B>
         {
            if(desc != null)
            {
                item = (ShoppingCartItem) items.get(desc);
            
                if(item == null)
                {
                    item = 
                      new ShoppingCartItem(desc,price,quantity);
                    items.put(desc,item);
                }
                else
                {
                    item.price = price;
                    item.quantity &#43;= quantity;
                }
            }
            else
            {
                errorMessage = "Unable to add item(s).";
            }
        }
</PRE>
<!-- END CODE //-->
<P>The adjust action tells the servlet to change the quantity of an existing item. In this case, an error occurs if the shopper attempts to adjust a nonexistent item.
</P>
<!-- CODE //-->
<PRE>
        <B>else if(</B>"<B>adjust</B>"<B>.equalsIgnoreCase(action))</B>
         {
            if(desc != null)
            {
                item = (ShoppingCartItem) items.get(desc);
            
                if(item != null)
                {
                    item.quantity = quantity;
                }
                else
                {
                    errorMessage = 
                       "Item(s) was not contained in the cart.";
                }
            }
            else
            {
                errorMessage = "Unable to adjust item(s).";
            }
        }
</PRE>
<!-- END CODE //-->
<P>There are three possible actions on a delete request. If the quantity of items being deleted is more than the existing quantity, the item is totally removed from the cart. If the quantity to remove is less than the existing quantity, the existing quantity is adjusted. If the shopper attempts to delete a nonexistent item, an error will occur.
</P>
<!-- CODE //-->
<PRE>
        <B>else if(</B>"<B>delete</B>"<B>.equalsIgnoreCase(action))</B>
         {
            if(desc != null)
            {
                item = (ShoppingCartItem) items.get(desc);
            
                if(item != null)
                {
                    if(item.quantity &gt quantity)
                    {
                        item.quantity -= quantity;
                    }
                    else
                    {
                        items.remove(desc);
                    }
                }
                else
                {
                    errorMessage = 
                       "Item(s) was not contained in the cart.";
                }
            }
            else
            {
                errorMessage = "Unable to remove item(s).";
            }
        }
        <B>//else just view</B>
</PRE>
<!-- END CODE //-->
<P><BR></P>
<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="11-03.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="11-05.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


<!-- 