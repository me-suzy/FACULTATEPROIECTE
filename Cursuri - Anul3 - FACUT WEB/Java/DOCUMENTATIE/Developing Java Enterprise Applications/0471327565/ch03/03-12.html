
<SCRIPT>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
	',height=' + height + ',resizable=1,scrollbars=yes');
	}
	//-->
	</SCRIPT>



<FONT FACE="Arial,Helvetica" SIZE="-1">
To access the contents, click the chapter and section titles.
</FONT>
<P>
<B>Developing Java Enterprise Applications</B>
<FONT SIZE="-1">
<BR>
<I>(Publisher: John Wiley & Sons, Inc.)</I>
<BR>
Author(s): Stephen Asbury ; Scott R. Weiner
<BR>
ISBN: 0471327565
<BR>
Publication Date: 02/01/99
</FONT>
<P>
<Script language="JavaScript">
function isIE4() 
{
    return( navigator.appName.indexOf("Microsoft") != -1 && (navigator.appVersion.charAt(0)=='4') );
 }
function bookMarkit()
{
        var url="http://www.itknowledge.com/PSUser/EWBookMarks.html?url="+window.location+"&isbn=0";
	parent.location.href=url;
        //var win = window.open(url,"myitk");
        //if(!isIE4())
        //       win.focus();

}
</Script>
<a href="javascript:bookMarkit();"><img src="/images/bookmarkit.gif" border=0 alt="Bookmark It" width=97 height=23></a>

<P>
<form name="Search" method="GET" action="http://search.earthweb.com/search97/search_redir.cgi">

<INPUT TYPE="hidden" NAME="Action" VALUE="Search">
<INPUT TYPE="hidden" NAME="SearchPage" VALUE="http://search.earthweb.com/search97/samples/forms/srchdemo.htm">
<INPUT TYPE="hidden" NAME="Collection" VALUE="ITK">
<INPUT TYPE="hidden" NAME="ResultTemplate" VALUE="itk-simple-intrabook.hts">
<INPUT TYPE="hidden" NAME="ViewTemplate" VALUE="view.hts">

<font face="arial, helvetica" size=2><b>Search this book:</b></font><br>
<INPUT NAME="queryText" size=50 VALUE="">&nbsp;<input type="submit" name="submitbutton" value="Go!">
<INPUT type=hidden NAME="section_on" VALUE="on">
<INPUT type=hidden NAME="section" VALUE="http://www.itknowledge.com/reference/standard/0471327565/">

</form>


<!-- Empty Reference Subhead -->

<!--ISBN=0471327565//-->
<!--TITLE=Developing Java Enterprise Applications//-->
<!--AUTHOR=Stephen Asbury//-->
<!--AUTHOR=Scott R. Weiner//-->
<!--PUBLISHER=Wiley Computer Publishing//-->
<!--CHAPTER=03//-->
<!--PAGES=053-055//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="03-11.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="03-13.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<P><BR></P>
<P><FONT SIZE="+1"><B><I>SQLExceptions</I></B></FONT></P>
<P>SQLException is a subclass of exception consisting of a string error message, a string containing the SQL state as defined by the XOPEN SQL state specification, and a driver&#150;specific int used as an additional error code. Here is an example:
</P>
<!-- CODE //-->
<PRE>
try
 {
    Statement s = con.createStatement();
}catch (SQLException e)
{
   System.println.out(e);
   System.println.out(&#147;Database Driver/Source error code: &#148; &#43;
                      e.getErrorCode());
   System.println.out(&#147;XOPEN SQL State: &#148; &#43; e.getSQLState());
}
</PRE>
<!-- END CODE //-->
<P>If multiple errors were generated, multiple SQLException instances can be chained together. To get access to the next error, call getNextException() on the SQLException object. To add to the chain, call setNextException().
</P>
<P><FONT SIZE="+1"><B><I>SQLWarnings</I></B></FONT></P>
<P>The SQLWarning class is a subclass of SQLException, but it is typically used for non&#150;critical errors. Usually, it is not thrown as an exception. Rather, it is typically up to the program to query for SQLWarnings by calling the getWarnings() method of any Connection, Statement, or ResultSet object. Each time these objects are used, they clear out the warnings by calling clearWarnings(). This means that if you do not poll for messages, you will not get them.
</P>
<P><FONT SIZE="+1"><B><I>Data Truncation</I></B></FONT></P>
<P>The DataTruncation class is a subclass of SQLWarning. A data truncation occurs when you perform a query and do not or cannot process all of the results. For example, you might get a data truncation warning if you perform a query that returns 15 rows, and you process only the first one with your result set before closing it. DataTruncation warnings are issued as part of a chain of SQLWarning messages. This means that as you process a SQLWarning chain of messages, you must look specifically for DataTruncation objects if you want to call DataTruncation&#150;specific methods. Finding a DataTruncation requires you to perform an instance of DataTruncation check on each SQLWarning.
</P>
<P>The following example illustrates this process:</P>
<!-- CODE //-->
<PRE>
SQLWarning warning = stmt.getWarnings();
 while (warning != null)
{
    System.out.println(warning.getMessage());
    if(warning instanceof DataTruncation)
    {
        DataTruncation dt = (DataTruncation)warning;
        if(dt.getParameter())
            System.out.print(&#147;The parameter had &#148;);
        System.out.print(&#147;A trunction error in column: &#148; &#43;
                         dt.getIndex() &#43;
                         &#147;should have tranfered &#148; &#43;
                         dt.getDataSize() &#43; &#147;bytes. &#148; &#43;
                         &#147;Actually transfered &#148; &#43;
                         dt.getTransferSize() &#43; &#147;bytes&#148;);
 
        if(dt.getRead())
            System.out.print(&#147; while reading.&#148;);
        else
            System.out.print(&#147;.&#148;);
                      
        System.out.println(&#147;&#148;);
    }

    warning = warning.getNextWarning();
}
</PRE>
<!-- END CODE //-->
<P>Notice that getWarnings continue to be called until null is returned. Null signifies that there are no more errors.
</P>
<P>The next section puts together the concepts discussed in this chapter by demonstrating a larger application.</P>
<H3><A NAME="Heading18"></A><FONT COLOR="#000077">Putting It Together</FONT></H3>
<P>The final example for this chapter is a complete Java application. This application uses the Java Foundation Classes (JFC), which are included with Java 2. If you are unfamiliar with JFC, you may want to read our book, <I>Programming with JFC</I> (John Wiley &amp Sons, 1998). This example is not meant to demonstrate the optimal use of all JDBC features. Rather, this is a combination of JDBC features that have been put in one application to demonstrate several capabilities of JDBC 1.0. The example illustrated in Figure 3.13 displays a list of inventory items from our INV database. Some columns are calculated. At the bottom of the main screen is a series of buttons:</P>
<DL>
<DD><B>Query Database.</B> This button loads the records from the database and displays them.
<DD><B>Delete Current Row.</B> Deletes the row from the database currently selected in the JTable.
<DD><B>Insert Row.</B> Inserts a new row in the JTable.
<DD><B>Start Transaction.</B> Starts a transaction. After this, all operations are in the transaction scope until the transaction is committed or rolled back.
<DD><B>Commit Transaction</B>. Commits the transaction if there is one in progress
<DD><B>Rollback Transaction.</B> Rolls back the transaction if there is one in progress.
</DL>
<P>The example consists of three classes:
</P>
<DL>
<DD><B>JDBCTable.</B> A subclass of JPanel that displays our UI, including a table of data.
<DD><B>JDBCTableModel.</B> A subclass of AbstractTableModel that implements all of the database access routines and keeps track of the current selection from the database.
<DD><B>WindowCloser.</B> A subclass of WindowAdapter used as a convenience class for quitting the application when the user closes the main window.
</DL>
<P>Let&#146;s look at each of these classes in detail.
</P>
<P><FONT SIZE="+1"><B><I>JDBCTable</I></B></FONT></P>
<P>The following code defines the JDBCTable class. The JDCTable class displays the main JPanel and places a JTable and six buttons in the table. JDBCTable handles the action for each button. The JDBCTable main method starts by creating a new JDBCTableModel, which takes a URL, a driver class name, a user name, and a password as parameters. The table uses a JDBCTableModel to connect to the database. Once the model connects to the database, the JDBCTable installs this model in the JTable.
</P>
<P><A NAME="Fig13"></A><A HREF="javascript:displayWindow('images/03-13.jpg',640,320 )"><IMG SRC="images/03-13t.jpg"></A>
<BR><A HREF="javascript:displayWindow('images/03-13.jpg',640,320)"><FONT COLOR="#000077"><B>Figure 3.13</B></FONT></A>&nbsp;&nbsp;JDBCTable application.<P><BR></P>
<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="03-11.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="03-13.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


<!-- 