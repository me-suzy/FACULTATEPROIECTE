
<SCRIPT>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
	',height=' + height + ',resizable=1,scrollbars=yes');
	}
	//-->
	</SCRIPT>



<FONT FACE="Arial,Helvetica" SIZE="-1">
To access the contents, click the chapter and section titles.
</FONT>
<P>
<B>Developing Java Enterprise Applications</B>
<FONT SIZE="-1">
<BR>
<I>(Publisher: John Wiley & Sons, Inc.)</I>
<BR>
Author(s): Stephen Asbury ; Scott R. Weiner
<BR>
ISBN: 0471327565
<BR>
Publication Date: 02/01/99
</FONT>
<P>
<Script language="JavaScript">
function isIE4() 
{
    return( navigator.appName.indexOf("Microsoft") != -1 && (navigator.appVersion.charAt(0)=='4') );
 }
function bookMarkit()
{
        var url="http://www.itknowledge.com/PSUser/EWBookMarks.html?url="+window.location+"&isbn=0";
	parent.location.href=url;
        //var win = window.open(url,"myitk");
        //if(!isIE4())
        //       win.focus();

}
</Script>
<a href="javascript:bookMarkit();"><img src="/images/bookmarkit.gif" border=0 alt="Bookmark It" width=97 height=23></a>

<P>
<form name="Search" method="GET" action="http://search.earthweb.com/search97/search_redir.cgi">

<INPUT TYPE="hidden" NAME="Action" VALUE="Search">
<INPUT TYPE="hidden" NAME="SearchPage" VALUE="http://search.earthweb.com/search97/samples/forms/srchdemo.htm">
<INPUT TYPE="hidden" NAME="Collection" VALUE="ITK">
<INPUT TYPE="hidden" NAME="ResultTemplate" VALUE="itk-simple-intrabook.hts">
<INPUT TYPE="hidden" NAME="ViewTemplate" VALUE="view.hts">

<font face="arial, helvetica" size=2><b>Search this book:</b></font><br>
<INPUT NAME="queryText" size=50 VALUE="">&nbsp;<input type="submit" name="submitbutton" value="Go!">
<INPUT type=hidden NAME="section_on" VALUE="on">
<INPUT type=hidden NAME="section" VALUE="http://www.itknowledge.com/reference/standard/0471327565/">

</form>


<!-- Empty Reference Subhead -->

<!--ISBN=0471327565//-->
<!--TITLE=Developing Java Enterprise Applications//-->
<!--AUTHOR=Stephen Asbury//-->
<!--AUTHOR=Scott R. Weiner//-->
<!--PUBLISHER=Wiley Computer Publishing//-->
<!--CHAPTER=18//-->
<!--PAGES=484-487//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="18-06.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="../ch19/19-01.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<P><BR></P>
<H4 ALIGN="LEFT"><A NAME="Heading17"></A><FONT COLOR="#000077">An Example Action Script</FONT></H4>
<P>The action script created for this example is only one line and causes a LogRequestAction to be created.
</P>
<!-- CODE SNIP //-->
<PRE>
&ltLOGREQUESTACTION&gt
</PRE>
<!-- END CODE SNIP //-->
<P>Certainly more complex actions for this request can be created.
</P>
<H4 ALIGN="LEFT"><A NAME="Heading18"></A><FONT COLOR="#000077">An Example Client</FONT></H4>
<P>The client created to test the check request bean is a simple command-line program. The program uses command-line arguments to assign the URL for the JNDI context, the user, and the password. This user and password must be defined by the EJB provider to make them valid to the enterprise bean. In this case, the users Stephen and Scott are defined for the BEAWebLogic server, with the passwords stephena and scottscott, respectively. If the client is run in the installation with any other user or password, including no user name, the check requests always fail because the rule will be invalid.
</P>
<!-- CODE //-->
<PRE>
package checkreq;

import javax.ejb.*;
import javax.naming.*;
import java.rmi.*;
import java.util.*;
import java.io.*;

import checkreq.*;

public class CheckRequestClient
{
    public static void main(String[] args)
    {
	Context ctx=null;
	
	try
	{
	    ctx = getInitialContext(args);
	    InputStreamReader readIn;
	    BufferedReader bufIn;
	    String payee;
	    String project;
	    String amtStr;
	    double amount;
	    String desc;
	    boolean success;
<B>            CheckRequestHome home = (CheckRequestHome)
		   ctx.lookup(&#147;checkreq.CheckRequestHome&#148;);
	    CheckRequest request = home.create();</B>

	    readIn = new InputStreamReader(System.in);
	    bufIn = new BufferedReader(readIn);
	
	    System.out.println(&#147;Please enter the payee.&#148;);
	
<B>            payee = bufIn.readLine().trim();</B>

	    System.out.println(&#147;Please enter the project.&#148;);
	
<B>            project = bufIn.readLine().trim();</B>

	    System.out.println(&#147;Please enter a description.&#148;);
	
<B>            desc = bufIn.readLine().trim();</B>

	    System.out.println(&#147;Please enter the amount.&#148;);
	
<B>            amtStr = bufIn.readLine().trim();</B>

	    try
	    {
<B>                amount = Double.valueOf(amtStr).doubleValue();</B>

<B>                success = request.requestCheck(payee,project
				     ,amount,desc);</B>

		if(success)
		    System.out.println(&#147;Your request was&#148;
				    &#43;&#147; processed.&#148;);
		else
		    System.out.println(&#147;Insuffecient permission&#148;
					&#43; &#147; for request.&#148;);
	    }
	    catch(NumberFormatException exp)
	    {
		System.out.println(&#147;That is an invalid amount.&#148;);
	    }
	
	    home.remove(request.getHandle());
	}
	catch (Exception e)
	{
	    System.out.println(&#147;Error.&#148;);
	    e.printStackTrace();
	}
	finally
	{
	    try
	    {
		ctx.close();
	    }
	    catch(Exception exp)
	    {
	    }
	}
    }
    static public Context getInitialContext(String[] args)
	  throws Exception
    {
	Properties p = new Properties();
	String url = &#147;t3://localhost:7001&#148;;
	String user=null;
	String password=null;

	if ((args != null) &amp&amp (args.length &gt 1))
	{
	    for (int i = 0; i &lt args.length; i<SMALL>&#43;&#43;</SMALL>)
	    {
		if (args[i].equals(&#147;-url&#148;))
		    url = args[<SMALL>&#43;&#43;</SMALL>i];
<B>                else if (args[i].equals(&#147;-user&#148;))
		    user = args[<SMALL>&#43;&#43;</SMALL>i];
		else if (args[i].equals(&#147;-password&#148;))
		    password = args[<SMALL>&#43;&#43;</SMALL>i];</B>
            }
	}

	p.put(Context.INITIAL_CONTEXT_FACTORY,
		&#147;weblogic.jndi.T3InitialContextFactory&#148;);

<B>        p.put(Context.PROVIDER_URL, url);

	if (user != null)
	{
	    p.put(Context.SECURITY_PRINCIPAL, user);

	    if (password == null) password = &#147;&#148;;
	
	    p.put(Context.SECURITY_CREDENTIALS, password);
	}

	return new InitialContext(p);</B>
    }
}
</PRE>
<!-- END CODE //-->
<P>If you run this client from the CD-ROM with the enterprise bean and the test script files installed on the server, stephen is validated for all requests and scott is validated for requests for the secret project. Try adding other rules that restrict the limit of a check&#146;s amount or make sure that the payee is not the writer.
</P>
<H3><A NAME="Heading19"></A><FONT COLOR="#000077">Summary</FONT></H3>
<P>Combining Enterprise JavaBeans with scripting is a powerful tool for enterprise applications. Enterprise beans create a separation between client code and core logic. They also rely on powerful features of the EJB host, such as connection pooling and transactional scoping, as discussed in Chapter 16, &#147;Programming Enterprise JavaBeans,&#148; and demonstrated in the larger example in Chapter 25, &#147;A Four-Tier Online Store.&#148; These host-provided services make programming with Enterprise JavaBeans easier than standard client/server applications. By integrating scripting, we created a bean that is easy to write and deploy and can still be updated as needed. This allows us to implement business rules easily and change them as needed. In the example, new people can easily be added to the request rules as they are given check-signing authority or removed as they lose authority. This chapter demonstrates that enterprise beans provide the foundation for a simple but powerful approach to multitier enterprise computing.
</P>
<P>The next chapter begins to discuss one of the other services that an application server can provide: messaging. Messaging is another form of interprogram communication that Java programs can use to share information and notifications.</P><P><BR></P>
<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="18-06.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="../ch19/19-01.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


<!-- 