
<SCRIPT>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
	',height=' + height + ',resizable=1,scrollbars=yes');
	}
	//-->
	</SCRIPT>



<FONT FACE="Arial,Helvetica" SIZE="-1">
To access the contents, click the chapter and section titles.
</FONT>
<P>
<B>Developing Java Enterprise Applications</B>
<FONT SIZE="-1">
<BR>
<I>(Publisher: John Wiley & Sons, Inc.)</I>
<BR>
Author(s): Stephen Asbury ; Scott R. Weiner
<BR>
ISBN: 0471327565
<BR>
Publication Date: 02/01/99
</FONT>
<P>
<Script language="JavaScript">
function isIE4() 
{
    return( navigator.appName.indexOf("Microsoft") != -1 && (navigator.appVersion.charAt(0)=='4') );
 }
function bookMarkit()
{
        var url="http://www.itknowledge.com/PSUser/EWBookMarks.html?url="+window.location+"&isbn=0";
	parent.location.href=url;
        //var win = window.open(url,"myitk");
        //if(!isIE4())
        //       win.focus();

}
</Script>
<a href="javascript:bookMarkit();"><img src="/images/bookmarkit.gif" border=0 alt="Bookmark It" width=97 height=23></a>

<P>
<form name="Search" method="GET" action="http://search.earthweb.com/search97/search_redir.cgi">

<INPUT TYPE="hidden" NAME="Action" VALUE="Search">
<INPUT TYPE="hidden" NAME="SearchPage" VALUE="http://search.earthweb.com/search97/samples/forms/srchdemo.htm">
<INPUT TYPE="hidden" NAME="Collection" VALUE="ITK">
<INPUT TYPE="hidden" NAME="ResultTemplate" VALUE="itk-simple-intrabook.hts">
<INPUT TYPE="hidden" NAME="ViewTemplate" VALUE="view.hts">

<font face="arial, helvetica" size=2><b>Search this book:</b></font><br>
<INPUT NAME="queryText" size=50 VALUE="">&nbsp;<input type="submit" name="submitbutton" value="Go!">
<INPUT type=hidden NAME="section_on" VALUE="on">
<INPUT type=hidden NAME="section" VALUE="http://www.itknowledge.com/reference/standard/0471327565/">

</form>


<!-- Empty Reference Subhead -->

<!--ISBN=0471327565//-->
<!--TITLE=Developing Java Enterprise Applications//-->
<!--AUTHOR=Stephen Asbury//-->
<!--AUTHOR=Scott R. Weiner//-->
<!--PUBLISHER=Wiley Computer Publishing//-->
<!--CHAPTER=26//-->
<!--PAGES=714-719//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="26-09.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="26-11.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<P><BR></P>
<P>The MiniProducer is associated with a destination and keeps track of this destination in an instance variable.
</P>
<P>Creating a MiniProducer initializes the instance variables, for which accessor methods are provided. The following code provides a snapshot of the MiniProducer.java file and contains embedded discussions for the interesting features in the MiniProducer class.</P>
<!-- CODE //-->
<PRE>
package minijms;

//Imports removed to save space.

public class MiniProducer
 implements MessageProducer,TopicPublisher,QueueSender
{
    protected MiniSession session;
    protected boolean disableMsgId;
    protected boolean disableTimestamp;
    protected int mode; //default mode
    protected int priority; //default priority
    protected int time; //default timeToLive
    protected MiniDestination dest;

    public MiniProducer(MiniSession session
                            ,MiniDestination dest)
    {
        this.session = session;
        this.dest = dest;

        disableMsgId = false;
        disableTimestamp = false;

        //default mode is not a correct value
        mode = DeliveryMode.PERSISTENT;

        priority = 4;
        time = Message.DEFAULT_TIME_TO_LIVE;
    }

    public void setDisableMessageID(boolean value)
     throws JMSException
    {
        disableMsgId = value;
    }

    public boolean getDisableMessageID()
     throws JMSException
    {
        return disableMsgId;
    }

    public void setDisableMessageTimestamp(boolean value)
     throws JMSException
    {
        disableTimestamp = value;
    }

    public boolean getDisableMessageTimestamp()
     throws JMSException
    {
        return disableTimestamp;
    }

    public void setDeliveryMode(int deliveryMode)
     throws JMSException
    {
        mode = deliveryMode;
    }

    public int getDeliveryMode() throws JMSException
    {
        return mode;
    }

    public void setPriority(int p) throws JMSException
    {
        priority = p;
    }

    public int getPriority() throws JMSException
    {
        return priority;
    }

    public void setTimeToLive(int timeToLive) throws JMSException
    {
        time = timeToLive;
    }

    public int getTimeToLive() throws JMSException
    {
        return time;
    }
</PRE>
<!-- END CODE //-->
<P>Closing a MiniProducer doesn&#146;t do anything because it doesn&#146;t require any server resources.
</P>
<!-- CODE SNIP //-->
<PRE>
    public void close() throws JMSException
    {
    }
</PRE>
<!-- END CODE SNIP //-->
<P>Like the MiniConsumer, a MiniProducer provides access to its destination as either a queue or topic, throwing an exception if the wrong method is used.
</P>
<!-- CODE //-->
<PRE>
    public Queue getQueue() throws JMSException
    {
        if(dest.isQueue()) return dest;
        else throw new JMSException();
    }

    public Topic getTopic() throws JMSException
    {
        if(!dest.isQueue()) return dest;
        else throw new JMSException();
    }
</PRE>
<!-- END CODE //-->
<P>QueueSender defines four methods for sending messages. MiniProducer implements all four but relies on a single method for the actual send. The first three methods listed here simply call the fourth method, using default values where appropriate.
</P>
<!-- CODE //-->
<PRE>
    public void send(Message message)
     throws JMSException
    {
        if(message != null)
        {
            <B>send(getQueue(), message, mode
                , priority, time);</B>
        }
        else
        {
            throw new JMSException(&#147;Null Message.&#148;);
        }
    }

    public void send(Message message,
              int deliveryMode, int pri,
               long timeToLive) throws JMSException
    {
        if(message != null)
        {
            <B>send(getQueue(),message, deliveryMode
                ,pri,timeToLive);</B>
        }
        else
        {
            throw new JMSException(&#147;Null Message.&#148;);
        }
    }

    public void send(Queue queue, Message message)
     throws JMSException
    {
        if((message != null)&amp&amp(queue!=null))
        {
            <B>send(queue, message, mode
                , priority, time);</B>
        }
        else
        {
            throw new JMSException(&#147;Null Message.&#148;);
        }
    }
</PRE>
<!-- END CODE //-->
<P>The final send method is the most versatile. This method configures the messages header, using the flags provided. If the message has a timeToLive, the expiration time is set to the current time plus this value. If time stamps are enabled, one is set; if message IDs are enabled, one is assigned. Once configured, the producers session is told to send the message.
</P>
<!-- CODE //-->
<PRE>
    public void send(Queue queue, Message message,
              int deliveryMode, int pri,
               long timeToLive) throws JMSException
    {
        long now = System.currentTimeMillis();

        if((message != null)&amp&amp(queue!=null))
        {
            if(session == null)
                throw new JMSException(&#147;No Session&#148;);

            <B>message.setJMSDestination(queue);
            message.setJMSPriority(pri);
            message.setJMSDeliveryMode(deliveryMode);

            if(timeToLive &lt= 0)
                message.setJMSExpiration(0);
            else
                message.setJMSExpiration(now &#43; timeToLive);

            if(!disableTimestamp)
            {
                message.setJMSMessageID(createId());
            }

            if(!disableTimestamp)
            {
                message.setJMSTimestamp(now);
            }

            session.send(message);</B>
        }
        else
        {
            throw new JMSException(&#147;Null Message.&#148;);
        }
    }
</PRE>
<!-- END CODE //-->
<P>TopicPublishers also provide a number of methods for sending messages to a topic. Again, these methods, listed below, are implemented in terms of the most generic form.
</P>
<!-- CODE //-->
<PRE>
    public void publish(Message message)
     throws JMSException
    {
        if(message != null)
        {
            <B>publish(getTopic(), message, mode
                , priority, time);</B>
        }
        else
        {
            throw new JMSException(&#147;Null Message.&#148;);
        }
    }

    public void publish(Message message,
              int deliveryMode, int pri,
               long timeToLive) throws JMSException
    {
        if(message != null)
        {
            <B>publish(getTopic(),message, deliveryMode
                ,pri,timeToLive);</B>
        }
        else
        {
            throw new JMSException(&#147;Null Message.&#148;);
        }
    }

    public void publish(Topic topic, Message message)
     throws JMSException
    {
        if((message != null)&amp&amp(topic!=null))
        {
            <B>publish(topic, message, mode
                , priority, time);</B>
        }
        else
        {
            throw new JMSException(&#147;Null Message.&#148;);
        }
    }
</PRE>
<!-- END CODE //-->
<P><BR></P>
<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="26-09.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="26-11.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


<!-- 