
<SCRIPT>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
	',height=' + height + ',resizable=1,scrollbars=yes');
	}
	//-->
	</SCRIPT>



<FONT FACE="Arial,Helvetica" SIZE="-1">
To access the contents, click the chapter and section titles.
</FONT>
<P>
<B>Developing Java Enterprise Applications</B>
<FONT SIZE="-1">
<BR>
<I>(Publisher: John Wiley & Sons, Inc.)</I>
<BR>
Author(s): Stephen Asbury ; Scott R. Weiner
<BR>
ISBN: 0471327565
<BR>
Publication Date: 02/01/99
</FONT>
<P>
<Script language="JavaScript">
function isIE4() 
{
    return( navigator.appName.indexOf("Microsoft") != -1 && (navigator.appVersion.charAt(0)=='4') );
 }
function bookMarkit()
{
        var url="http://www.itknowledge.com/PSUser/EWBookMarks.html?url="+window.location+"&isbn=0";
	parent.location.href=url;
        //var win = window.open(url,"myitk");
        //if(!isIE4())
        //       win.focus();

}
</Script>
<a href="javascript:bookMarkit();"><img src="/images/bookmarkit.gif" border=0 alt="Bookmark It" width=97 height=23></a>

<P>
<form name="Search" method="GET" action="http://search.earthweb.com/search97/search_redir.cgi">

<INPUT TYPE="hidden" NAME="Action" VALUE="Search">
<INPUT TYPE="hidden" NAME="SearchPage" VALUE="http://search.earthweb.com/search97/samples/forms/srchdemo.htm">
<INPUT TYPE="hidden" NAME="Collection" VALUE="ITK">
<INPUT TYPE="hidden" NAME="ResultTemplate" VALUE="itk-simple-intrabook.hts">
<INPUT TYPE="hidden" NAME="ViewTemplate" VALUE="view.hts">

<font face="arial, helvetica" size=2><b>Search this book:</b></font><br>
<INPUT NAME="queryText" size=50 VALUE="">&nbsp;<input type="submit" name="submitbutton" value="Go!">
<INPUT type=hidden NAME="section_on" VALUE="on">
<INPUT type=hidden NAME="section" VALUE="http://www.itknowledge.com/reference/standard/0471327565/">

</form>


<!-- Empty Reference Subhead -->

<!--ISBN=0471327565//-->
<!--TITLE=Developing Java Enterprise Applications//-->
<!--AUTHOR=Stephen Asbury//-->
<!--AUTHOR=Scott R. Weiner//-->
<!--PUBLISHER=Wiley Computer Publishing//-->
<!--CHAPTER=21//-->
<!--PAGES=557-561//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="../ch20/20-17.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="21-02.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<P><BR></P>
<H2><A NAME="Heading1"></A><FONT COLOR="#000077">CHAPTER 21<BR>A JMS-Based Alarm System
</FONT></H2>
<P>One of the primary applications of messaging is <I>notification.</I> Many of the IS departments using messaging today are using it to tie together different systems. Often, the goal is to notify one system when a value in another system changes. For example, the human resources system might notify the financial system when a new employee is hired. Because one of the easiest examples of notification in the real world is an alarm clock, the alarm clock is used as a symbol in this chapter and extended to the computer using the Java Messaging Service.</P>
<P>In our example, a server program manages a list of registered alarms. These alarms associate a name, a time, and a message with each other. The server saves pending alarms in a file when it is not running and in memory when it is running. When an alarm &#147;goes off,&#148; the alarm server notifies other applications using a message published to a JMS Topic.</P>
<P>Alarms are configured by an application called AlarmConfig. This program displays an interface, shown in Figure 21.1, that allows the user to specify the name, time, and message for an alarm. The currently registered alarms are displayed in a list, and the user can update or delete alarms.</P>
<P>Because the alarm server is a command-line utility, it doesn&#146;t have an easy way to shut down. In contrast, the AlarmConfig application provides a button for shutting down the server.</P>
<P>The last application in this example is called AlarmDaemon. This application displays a simple window, pictured in Figure 21.2, that displays a button for quitting the application. The alarm daemon listens to the server&#146;s alarm Topic and displays an alert to the user when an alarm &#147;goes off.&#148; An example of this alert is pictured in Figure 21.3.</P>
<P><A NAME="Fig1"></A><A HREF="javascript:displayWindow('images/21-01.jpg',370,282 )"><IMG SRC="images/21-01t.jpg"></A>
<BR><A HREF="javascript:displayWindow('images/21-01.jpg',370,282)"><FONT COLOR="#000077"><B>Figure 21.1</B></FONT></A>&nbsp;&nbsp;AlarmConfig interface.</P>
<P><A NAME="Fig2"></A><A HREF="javascript:displayWindow('images/21-02.jpg',325,125 )"><IMG SRC="images/21-02t.jpg"></A>
<BR><A HREF="javascript:displayWindow('images/21-02.jpg',325,125)"><FONT COLOR="#000077"><B>Figure 21.2</B></FONT></A>&nbsp;&nbsp;AlarmDaemon interface.</P>
<P>Two JMS destinations are used in this example. The names of these destinations are stored in the AlarmServer class as static variables. The first destination is called ADMIN_QUEUE. This is a JMS Queue used by the AlarmConfig program to communicate with the AlarmServer. A queue is used here because only one server should be receiving administrative messages. Messages in the admin queue are expected to be JMS MapMessages. The contents of the message are named by the keys in the message. AlarmServer defines two keys: ACTION and ALARM. The value of the ACTION key should be a string containing one of the four operations listed in Table 21.1. These operations indicate the administrative action that the server is supposed to take. The value of the ALARM key is an Alarm object.
</P>
<P>Notice how you can use a message&#146;s contents to define a message type. A JMS application is really a set of programs communicating with messages. The format and content of these messages is one of the primary design elements in the development process.</P>
<P><A NAME="Fig3"></A><A HREF="javascript:displayWindow('images/21-03.jpg',264,111 )"><IMG SRC="images/21-03t.jpg"></A>
<BR><A HREF="javascript:displayWindow('images/21-03.jpg',264,111)"><FONT COLOR="#000077"><B>Figure 21.3</B></FONT></A>&nbsp;&nbsp;Alarm alert panel.</P>
<TABLE WIDTH="100%">
<TR>
<TD CAPTION ALIGN="LEFT" VALIGN="TOP" COLSPAN="2"><B>Table 21.1</B> Alarm Server Actions
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TH WIDTH="25%" ALIGN="LEFT" VALIGN="TOP">ACTION NAME
<TH WIDTH="55%" ALIGN="LEFT" VALIGN="TOP">DESCRIPTION
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD ALIGN="LEFT" VALIGN="TOP"><SMALL>SHUTDOWN</SMALL>
<TD ALIGN="LEFT" VALIGN="TOP">Tells the server to save existing alarms to file and shut down.
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD ALIGN="LEFT" VALIGN="TOP"><SMALL>SET</SMALL>
<TD ALIGN="LEFT" VALIGN="TOP">Sets a new alarm.
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD ALIGN="LEFT" VALIGN="TOP"><SMALL>DELETE</SMALL>
<TD ALIGN="LEFT" VALIGN="TOP">Deletes an existing alarm by name, time, and description.
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD ALIGN="LEFT" VALIGN="TOP"><SMALL>GET_ALARMS</SMALL>
<TD ALIGN="LEFT" VALIGN="TOP">Requests a list of existing alarms from the server; these are published to the ALARM_TOPIC destination.
<TR>
<TD COLSPAN="2"><HR>
<TR>
</TABLE>
<P>The second destination for our alarm system is called ALARM_TOPIC. ALARM_TOPIC is a JMS Topic used by the server to publish notifications when an alarm goes off. The messages on this destination are ObjectMessages containing one of two types of objects: either an Alarm or a Vector. Simple alarm notifications contain an Alarm object, discussed in the &#147;Alarm&#148; section. The server also sends out messages containing a Vector of alarms for use by the configuration program.
</P>
<P>The design of this application was motivated by the educational requirement of showing off JMS. As a result, the underlying architecture may be considered heavier than necessary. In the context of a book, this heaviness is an advantage in that the simple Alarm example demonstrates the techniques used in much larger-enterprise scenarios. See Chapter 20, &#147;Programming with the Java Messaging Service,&#148; for information on MiniJMS, the JMS provider used throughout this book. Chapter 20 also describes the steps required to run this example and the other JMS examples in the book.</P>
<P>All of the examples in this book use the same properties file, shown below, to define their JNDI information. This properties file also defines the file to which alarms are saved when the server is shut down.</P>
<!-- CODE SNIP //-->
<PRE>
java.naming.factory.initial=\
             com.sun.jndi.fscontext.RefFSContextFactory
java.naming.provider.url=file:///temp/jndistore

alarmfile=c:\\temp\\alarms.ser
</PRE>
<!-- END CODE SNIP //-->
<P>As with the other JMS example, the Alarm application uses the file system JNDI context. The default directory for saving alarms is c:\temp\alarms.ser, but you can change this; \ is an escape character in this format, so use \\ in DOS-style file paths.
</P>
<H3><A NAME="Heading2"></A><FONT COLOR="#000077">Alarm</FONT></H3>
<P>In this example, alarms are represented by Alarm objects. Alarm is basically a data entity-style class. It stores a name, time, and message in strings. The objects are serializable so that they can be saved to disk or passed as part of messages. The only interesting code for this class is the implementation of hashCode and equals. These methods are overridden to ensure that two alarms having the same name try to hash differently and that two Alarm objects can be equal without being the same object.
</P>
<P>All of the objects specifically for this example are contained in the alarm package:</P>
<!-- CODE //-->
<PRE>
package alarm;

import java.io.*;

public class Alarm
 implements Serializable
{
    protected String name;
    protected String time;
    protected String msg;
   
    public Alarm(String nm)
    {
        name = nm;
    }
   
    public String toString()
    {
        return name&#43;&#147; &#148;&#43;time;
    }
   
    <B>public int hashCode()
    {
        return (time&#43;name&#43;msg).hashCode();
    }
   
    public boolean equals(Object o)
    {
        boolean retVal = false;
       
        if((o!=null)&amp&amp(o instanceof Alarm)
            &amp&amp(name!=null)&amp&amp(msg!=null)
            &amp&amptime!=null)
        {
            Alarm a = (Alarm) o;
           
            retVal =
                (name.equals(a.getName())
                 &amp&amp time.equals(a.getTime())
                 &amp&amp msg.equals(a.getMessage()));
        }
       
        return retVal;
    }</B>
   
    public String getName()
    {
        return name;
    }
   
    public void setName(String s)
    {
        name = s;
    }
   
    public String getTime()
    {
        return time;
    }
   
    public void setTime(String s)
    {
        time = s;
    }
   
    public String getMessage()
    {
        return msg;
    }
   
    public void setMessage(String s)
    {
        msg = s;
    }
}
</PRE>
<!-- END CODE //-->
<P><BR></P>
<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="../ch20/20-17.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="21-02.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


<!-- 