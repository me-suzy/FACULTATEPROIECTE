
<SCRIPT>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
	',height=' + height + ',resizable=1,scrollbars=yes');
	}
	//-->
	</SCRIPT>



<FONT FACE="Arial,Helvetica" SIZE="-1">
To access the contents, click the chapter and section titles.
</FONT>
<P>
<B>Developing Java Enterprise Applications</B>
<FONT SIZE="-1">
<BR>
<I>(Publisher: John Wiley & Sons, Inc.)</I>
<BR>
Author(s): Stephen Asbury ; Scott R. Weiner
<BR>
ISBN: 0471327565
<BR>
Publication Date: 02/01/99
</FONT>
<P>
<Script language="JavaScript">
function isIE4() 
{
    return( navigator.appName.indexOf("Microsoft") != -1 && (navigator.appVersion.charAt(0)=='4') );
 }
function bookMarkit()
{
        var url="http://www.itknowledge.com/PSUser/EWBookMarks.html?url="+window.location+"&isbn=0";
	parent.location.href=url;
        //var win = window.open(url,"myitk");
        //if(!isIE4())
        //       win.focus();

}
</Script>
<a href="javascript:bookMarkit();"><img src="/images/bookmarkit.gif" border=0 alt="Bookmark It" width=97 height=23></a>

<P>
<form name="Search" method="GET" action="http://search.earthweb.com/search97/search_redir.cgi">

<INPUT TYPE="hidden" NAME="Action" VALUE="Search">
<INPUT TYPE="hidden" NAME="SearchPage" VALUE="http://search.earthweb.com/search97/samples/forms/srchdemo.htm">
<INPUT TYPE="hidden" NAME="Collection" VALUE="ITK">
<INPUT TYPE="hidden" NAME="ResultTemplate" VALUE="itk-simple-intrabook.hts">
<INPUT TYPE="hidden" NAME="ViewTemplate" VALUE="view.hts">

<font face="arial, helvetica" size=2><b>Search this book:</b></font><br>
<INPUT NAME="queryText" size=50 VALUE="">&nbsp;<input type="submit" name="submitbutton" value="Go!">
<INPUT type=hidden NAME="section_on" VALUE="on">
<INPUT type=hidden NAME="section" VALUE="http://www.itknowledge.com/reference/standard/0471327565/">

</form>


<!-- Empty Reference Subhead -->

<!--ISBN=0471327565//-->
<!--TITLE=Developing Java Enterprise Applications//-->
<!--AUTHOR=Stephen Asbury//-->
<!--AUTHOR=Scott R. Weiner//-->
<!--PUBLISHER=Wiley Computer Publishing//-->
<!--CHAPTER=25//-->
<!--PAGES=617-622//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="../ch24/24-05.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="25-02.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<P><BR></P>
<H2><A NAME="Heading1"></A><FONT COLOR="#000077">CHAPTER 25<BR>A Four-Tier Online Store
</FONT></H2>
<P>This chapter and Chapter 26, &#147;MiniJMS: A Java Messaging Service Provider,&#148; include large examples that combine a number of the technologies discussed in this book. This chapter uses Enterprise JavaBeans, JDBC, servlets, and JavaServer Pages to create an online store. An online store was chosen for this example because it is familiar, but these concepts and techniques apply equally well to other enterprise applications. The primary goals for this example are:
</P>
<DL>
<DD><B>&#149;</B>&nbsp;&nbsp;To provide an example that integrates multiple Enterprise Java frameworks
<DD><B>&#149;</B>&nbsp;&nbsp;To trade performance for simplicity in implementation, where necessary
<DD><B>&#149;</B>&nbsp;&nbsp;To provide an example that is complex enough to challenge readers and test their understanding of the concepts discussed in this book
</DL>
<P>The root of these goals is to provide a large, real-world example of how enterprise APIs are used. Of course, including a complete, large-enterprise application is beyond the scope of this book. In fact, this example contains about 2,000 lines of code in 20 classes, making it rather large to include in this chapter. As a result, the entire example is not included in text but is available on the CD-ROM. The key code for this example is included and described in this chapter.
</P>
<H3><A NAME="Heading2"></A><FONT COLOR="#000077">Basic Design</FONT></H3>
<P>The user&#146;s experience for this online store is similar to the simple version created in Chapter 11, &#147;A JavaServer Page Online Store.&#148; When users first enter the store, they are presented with a welcome page, pictured in Figure 25.1. This page displays a list of the categories from which a user can choose, as well as a form for searching the site and the option of viewing the shopping cart. At the top of the page is a clickable advertisement.
</P>
<P>If the user chooses a category, he is presented with a list of items for that category. This page also displays an advertisement at the top, as pictured in Figure 25.2.</P>
<P>Both the list of categories and list of products for each category are generated dynamically based on the directory structure of the store Web site. The list of products is related to the HTML files in a category directory, and the list of categories is related to the category directories in the store&#146;s root directory. JavaServer Pages are used to generate these dynamic lists. Advertisements are presented using the AdRotatorServlet. This is an enhanced version of the servlet discussed in previous chapters.</P>
<P>Upon selecting an item, the user is presented with information about the item and the option to add it to the shopping cart. There is also an option to view the cart without adding an item. An example of these item pages is pictured in Figure 25.3. The test items pages have one shortfall&#151;that is, they do not contain a link back to their category pages. This link could be added easily in a commercial deployment. Otherwise, these are basically the sorts of pages that you see at online stores today.</P>
<P><A NAME="Fig1"></A><A HREF="javascript:displayWindow('images/25-01.jpg',626,689 )"><IMG SRC="images/25-01t.jpg"></A>
<BR><A HREF="javascript:displayWindow('images/25-01.jpg',626,689)"><FONT COLOR="#000077"><B>Figure 25.1</B></FONT></A>&nbsp;&nbsp;Online store home page.</P>
<P><A NAME="Fig2"></A><A HREF="javascript:displayWindow('images/25-02.jpg',626,440 )"><IMG SRC="images/25-02t.jpg"></A>
<BR><A HREF="javascript:displayWindow('images/25-02.jpg',626,440)"><FONT COLOR="#000077"><B>Figure 25.2</B></FONT></A>&nbsp;&nbsp;A category page.</P>
<P>By either choosing to add the item to the cart or view the cart, the shopper initiates the ShoppingCart servlet that displays the current cart. The cart displays a list of the current items, their quantities, and prices, as pictured in Figure 25.4. At this point, the shopper can attempt to purchase the items, adjust the quantity of an item, or delete an item from the cart. A link is also provided that returns the user to the page he was on before initiating the cart servlet.
</P>
<P><A NAME="Fig3"></A><A HREF="javascript:displayWindow('images/25-03.jpg',626,491 )"><IMG SRC="images/25-03t.jpg"></A>
<BR><A HREF="javascript:displayWindow('images/25-03.jpg',626,491)"><FONT COLOR="#000077"><B>Figure 25.3</B></FONT></A>&nbsp;&nbsp;An item page.</P>
<P><A NAME="Fig4"></A><A HREF="javascript:displayWindow('images/25-04.jpg',626,547 )"><IMG SRC="images/25-04t.jpg"></A>
<BR><A HREF="javascript:displayWindow('images/25-04.jpg',626,547)"><FONT COLOR="#000077"><B>Figure 25.4</B></FONT></A>&nbsp;&nbsp;The shopping cart and its contents.</P>
<P>If the shopper chooses to purchase the items in the cart, the shopping cart servlet contacts an Enterprise JavaBean and confirms the availability and price of the items. Based on the bean&#146;s response, the servlet displays a confirmation page, pictured in Figure 25.5. The confirmation page highlights any problems with the order and displays a field for the user to enter his confirmation password.
</P>
<P>Confirming the purchase tells the Shopping Cart servlet to again contact the ShoppingCart bean, this time requesting the purchase. If the purchase is successful, the servlet notifies the user with the page pictured in Figure 25.6.</P>
<P><A NAME="Fig5"></A><A HREF="javascript:displayWindow('images/25-05.jpg',626,423 )"><IMG SRC="images/25-05t.jpg"></A>
<BR><A HREF="javascript:displayWindow('images/25-05.jpg',626,423)"><FONT COLOR="#000077"><B>Figure 25.5</B></FONT></A>&nbsp;&nbsp;Confirmation page.</P>
<P><A NAME="Fig6"></A><A HREF="javascript:displayWindow('images/25-06.jpg',626,330 )"><IMG SRC="images/25-06t.jpg"></A>
<BR><A HREF="javascript:displayWindow('images/25-06.jpg',626,330)"><FONT COLOR="#000077"><B>Figure 25.6</B></FONT></A>&nbsp;&nbsp;Purchase Confirmed page.</P>
<P>If an error occurs in the ShoppingCartServlet at any point, an error page is sent to the shopper. For example, this error may indicate insufficient credit to make a purchase.
</P>
<P>The shopping cart EJB that supports the ShoppingCartServlet uses JDBC to talk to a database. This database contains the store&#146;s inventory as well as the registered shoppers and their credit limits. The bean acts as the interface to this database and implements all of the JDBC code used to implement the store.</P>
<P>The front page also contains a form that the shopper can use to search for a product. The searching is implemented using the HTMLSearchServlet discussed in Chapter 8, &#147;A Servlet-Based Search Engine.&#148; The search engine displays a list of links to relevant pages. (For a more detailed discussion of the search engine, please refer to Chapter 8.)</P>
<P>One example report is included with this example. This report is implemented using a servlet called InventoryServlet. When requested, the InventoryServlet contacts the ShoppingCartBean to retrieve a list of the current products in inventory. This list is displayed to the client in tabular form, including the description, quantity, and price of the item as well as the current sales figures for each item. An example page from the InventoryServlet is pictured in Figure 25.7.</P>
<P>This example builds on a number of the examples used in other chapters. As a result, code has not been repeated here unless it changed significantly. Other chapters are referenced where appropriate so that you can find the code when needed. The entire code for this example is available, in one directory, on the CD-ROM.</P>
<P>The code for this example is organized into a single directory containing two packages. These packages are shopcart.ejbs and shopcart.servlets, and they contain the EJB and servlet code, respectively.</P>
<H3><A NAME="Heading3"></A><FONT COLOR="#000077">The Shopping Cart EJB</FONT></H3>
<P>All of the actual purchasing in this example is managed by a single Enterprise JavaBean called ShoppingCartBean. The interface for this bean, called ShoppingCart, defines the methods used by servlets or other clients to access the inventory and credit databases. To keep this example manageable, the schema for this database is fairly simple. There are two tables: INVENTORY and CUSTOMERS. INVENTORY contains four columns, described in Table 25.1.
</P>
<P><A NAME="Fig7"></A><A HREF="javascript:displayWindow('images/25-07.jpg',626,467 )"><IMG SRC="images/25-07t.jpg"></A>
<BR><A HREF="javascript:displayWindow('images/25-07.jpg',626,467)"><FONT COLOR="#000077"><B>Figure 25.7</B></FONT></A>&nbsp;&nbsp;Inventory report.</P>
<P>CUSTOMERS contains three columns, described in Table 25.2.
</P>
<P>The customer&#146;s name is used for identification to confirm a purchase. Applications could also include a password for this identification, although this password could be part of the servlet&#146;s environment, the JNDI context, or some other aspect of the design.</P><P><BR></P>
<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="../ch24/24-05.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="25-02.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


<!-- 