
<SCRIPT>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
	',height=' + height + ',resizable=1,scrollbars=yes');
	}
	//-->
	</SCRIPT>



<FONT FACE="Arial,Helvetica" SIZE="-1">
To access the contents, click the chapter and section titles.
</FONT>
<P>
<B>Developing Java Enterprise Applications</B>
<FONT SIZE="-1">
<BR>
<I>(Publisher: John Wiley & Sons, Inc.)</I>
<BR>
Author(s): Stephen Asbury ; Scott R. Weiner
<BR>
ISBN: 0471327565
<BR>
Publication Date: 02/01/99
</FONT>
<P>
<Script language="JavaScript">
function isIE4() 
{
    return( navigator.appName.indexOf("Microsoft") != -1 && (navigator.appVersion.charAt(0)=='4') );
 }
function bookMarkit()
{
        var url="http://www.itknowledge.com/PSUser/EWBookMarks.html?url="+window.location+"&isbn=0";
	parent.location.href=url;
        //var win = window.open(url,"myitk");
        //if(!isIE4())
        //       win.focus();

}
</Script>
<a href="javascript:bookMarkit();"><img src="/images/bookmarkit.gif" border=0 alt="Bookmark It" width=97 height=23></a>

<P>
<form name="Search" method="GET" action="http://search.earthweb.com/search97/search_redir.cgi">

<INPUT TYPE="hidden" NAME="Action" VALUE="Search">
<INPUT TYPE="hidden" NAME="SearchPage" VALUE="http://search.earthweb.com/search97/samples/forms/srchdemo.htm">
<INPUT TYPE="hidden" NAME="Collection" VALUE="ITK">
<INPUT TYPE="hidden" NAME="ResultTemplate" VALUE="itk-simple-intrabook.hts">
<INPUT TYPE="hidden" NAME="ViewTemplate" VALUE="view.hts">

<font face="arial, helvetica" size=2><b>Search this book:</b></font><br>
<INPUT NAME="queryText" size=50 VALUE="">&nbsp;<input type="submit" name="submitbutton" value="Go!">
<INPUT type=hidden NAME="section_on" VALUE="on">
<INPUT type=hidden NAME="section" VALUE="http://www.itknowledge.com/reference/standard/0471327565/">

</form>


<!-- Empty Reference Subhead -->

<!--ISBN=0471327565//-->
<!--TITLE=Developing Java Enterprise Applications//-->
<!--AUTHOR=Stephen Asbury//-->
<!--AUTHOR=Scott R. Weiner//-->
<!--PUBLISHER=Wiley Computer Publishing//-->
<!--CHAPTER=05//-->
<!--PAGES=117-121//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="05-12.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="05-14.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<P><BR></P>
<TABLE WIDTH="90%">
<TD CAPTION COLSPAN="2"><B>Table 5.13</B> SearchControls Serialized Values 
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TH WIDTH="35%" VALIGN="TOP" ALIGN="LEFT">FIELD 
<TH WIDTH="55%" VALIGN="TOP" ALIGN="LEFT">PURPOSE 
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT"><SMALL>String[] attributesToReturn</SMALL>
<TD VALIGN="TOP" ALIGN="LEFT">Contains the list of attributes to be returned in SearchResult for each matching entry of search. If attributesToReturn returns null, all attributes are to be returned.
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT"><SMALL>long countLimit</SMALL>
<TD VALIGN="TOP" ALIGN="LEFT">Contains the maximum number of SearchResults to return.
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT"><SMALL>boolean derefLink</SMALL>
<TD VALIGN="TOP" ALIGN="LEFT">Indicates whether JNDI links are dereferenced during search.
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT"><SMALL>boolean returnObj </SMALL>
<TD VALIGN="TOP" ALIGN="LEFT">Indicates whether the object is returned as part of the SearchResult.
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT"><SMALL>int searchScope</SMALL>
<TD VALIGN="TOP" ALIGN="LEFT">Contains the scope to apply to the search. The scope is one for the following: ONELEVEL_SCOPE, OBJECT_SCOPE, or SUBTREE_SCOPE.
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT"><SMALL>int timeLimit</SMALL>
<TD VALIGN="TOP" ALIGN="LEFT">Contains the maximum number of milliseconds to wait before returning from search. 
<TR>
<TD COLSPAN="2"><HR>
<TR>
</TABLE>
<!-- CODE //-->
<PRE>
public static void main(String[] argc)
    {
        Hashtable env = new Hashtable(11);

        env.put(Context.INITIAL_CONTEXT_FACTORY,
            &#147;com.sun.jndi.ldap.LdapCtxFactory&#148;);
        env.put(Context.PROVIDER_URL,
            &#147;ldap://MyHost/o=JNDIExample&#148;);

        try
        {
            DirContext dctx = new InitialDirContext(env);

            String filter = &#147;(&amp(cn=S*)(account&gt1005))&#148;;

            String[] attrIDs = {&#147;cn&#148;, &#147;email&#148;};
            <B>SearchControls sc = new SearchControls();
            sc.setReturningAttributes(attrIDs);</B>

            NamingEnumeration result =
                dctx.search(&#147;ou=People&#148;, filter, <B>sc</B>);

            while (result.hasMore())
            {
                SearchResult sr = (SearchResult)result.next();
                System.out.println(&#147;Result = &#148; &#43; sr.getName());
            }
        }catch(NamingException e)
        {
            System.out.println(e);
        }
    }
}
</PRE>
<!-- END CODE //-->
<P>In this example, a SearchControls object is instantiated, and its method setReturningAttributes is passed an array of attribute names. This SearchControls object is passed into the search method and controls the result by limiting the attributes returned to name (cn is an LDAP convention standing for <I>common name</I>) and email. This process results in a query similar to passing in an attributes list. The output of the example resembles Figure 5.11.</P>
<P>As you can see, only the attributes specified in SearchControls were retrieved.</P>
<P><A NAME="Fig11"></A><A HREF="javascript:displayWindow('images/05-11.jpg',572,174 )"><IMG SRC="images/05-11t.jpg"></A>
<BR><A HREF="javascript:displayWindow('images/05-11.jpg',572,174)"><FONT COLOR="#000077"><B>Figure 5.11</B></FONT></A>&nbsp;&nbsp;Results of fetching specific attributes.</P>
<P><FONT SIZE="+1"><B><I>Control the Scope of a Search</I></B></FONT></P>
<P>By default, using SearchControls when searching a directory sets your search scope to SearchControls.ONELEVEL_SCOPE. Only the currently named context is searched for matches to your filter. Other options include:
</P>
<DL>
<DD><B>&#149;</B>&nbsp;&nbsp;<B>SearchControls.SUBTREE_SCOPE.</B> Searches the named context and all subcontexts.
<DD><B>&#149;</B>&nbsp;&nbsp;<B>SearchControls.OBJECT_SCOPE.</B> Searches the named object only to determine if it matches the search filter.
</DL>
<P>Here is an example of using a SUBTREE_SCOPE:
</P>
<!-- CODE //-->
<PRE>
import javax.naming.*;
import javax.naming.directory.*;
import java.util.Hashtable;

public class SearchScopeExample
{
    public static void main(String[] argc)
    {
        Hashtable env = new Hashtable(11);

        env.put(Context.INITIAL_CONTEXT_FACTORY,
            &#147;com.sun.jndi.ldap.LdapCtxFactory&#148;);
        env.put(Context.PROVIDER_URL,
            &#147;ldap://MyHost/o=JNDIExample&#148;);

        try
        {
            DirContext dctx = new InitialDirContext(env);

            String filter = &#147;(&amp(cn=S*)(account&gt1000))&#148;;

            String[] attrIDs = {&#147;cn&#148;, &#147;email&#148;};
            SearchControls sc = new SearchControls();
            sc.setReturningAttributes(attrIDs);
            <B>sc.setSearchScope(SearchControls.SUBTREE_SCOPE);</B>

            NamingEnumeration result =
                dctx.search(&#147;ou=People&#148;, filter, sc);

            while (result.hasMore())
            {
                SearchResult sr = (SearchResult)result.next();
                System.out.println(&#147;Result = &#148; &#43; sr.getName());
            }
        }catch(NamingException e)
        {
            System.out.println(e);
        }
    }
}
</PRE>
<!-- END CODE //-->
<P>This code searches the initial context of the named object (People) and any subcontexts beneath it. Figure 5.12 shows how the results differ if the SUBTREE_SCOPE is replaced with OBJECT_SCOPE or ONELEVEL_SCOPE. Use OBJECT_SCOPE to search only the named object, ONELEVEL_SCOPE to search the entire context of the named object, and SUBTREE_SCOPE to search the context and all its subcontexts. Obviously, SUBTREE_SCOPE could be a costly search for a large directory structure.
</P>
<P>Search controls are powerful tools for helping you narrow your search and improve performance. However, search controls can do much more, as the next few sections will show.</P>
<P><FONT SIZE="+1"><B><I>Traverse Links</I></B></FONT></P>
<P>Services may support the notion of a link. A <I>link</I> is an entry in a context that references another entry. This is similar to a symbolic link in a file system. Your search can be configured to either traverse these links, looking for matches to a search, or it can be configured to ignore the path of the link. To do this, call the SearchControls method setDerefLinkFlag and pass a Boolean. Here is an example:</P>
<!-- CODE SNIP //-->
<PRE>
...
SearchControls sc = new SearchControls();
<B>// Traverse links
sc.setDerefLinkFlag(true);</B>
...
</PRE>
<!-- END CODE SNIP //-->
<P>By setting the dereference link flag to true in this code, a search traverses links in the directory and continues the search. A setting of false would prevent such a traversal and thereby shorten the search.
</P>
<P><FONT SIZE="+1"><B><I>Retrieve Objects</I></B></FONT></P>
<P>SearchControls allows you to specify whether you want to retrieve objects that are bound to your directory or just the name of the object and its class. By bringing back only the names of the object and class, you can greatly improve the performance of a To do this, call the SearchControls method setReturningObjFlag and pass a Boolean. Here is an example:
</P>
<P><A NAME="Fig12"></A><A HREF="javascript:displayWindow('images/05-12.jpg',570,182 )"><IMG SRC="images/05-12t.jpg"></A>
<BR><A HREF="javascript:displayWindow('images/05-12.jpg',570,182)"><FONT COLOR="#000077"><B>Figure 5.12</B></FONT></A>&nbsp;&nbsp;SearchControls scopes.query.</P>
<!-- CODE SNIP //-->
<PRE>
...
SearchControls sc = new SearchControls();
// Retrieve the actual object from the directory
<B>sc.setReturningObjFlag(true);</B>
...
</PRE>
<!-- END CODE SNIP //-->
<P>By setting the return object flag to true in this code, the search returns a set of objects from the directory. This results in a slower search but returns much more data. Setting this flag to false only returns the names of the objects, which is a much faster operation. Set this flag to false if you only want to browse the directory rather than actually fetching and manipulating the objects in it.
</P>
<P><FONT SIZE="+1"><B><I>Control the Number of Results</I></B></FONT></P>
<P>At times, you search a directory and your query returns a large number of results. It is often a good idea to control the number of results so your program does not get overwhelmed by gigabytes of data. To do this, call the SearchControls method setCountLimit and pass in the number of results you want. Then your search will not return more than that many results. If there are more results than are returned, the exception SizeLimitExceededException is thrown by the NamingEnumeration. To retrieve all results, set the SearchControl&#146;s count limit to 0. Here is an example:
</P><P><BR></P>
<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="05-12.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="05-14.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


<!-- 